<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="加速你的 zsh —— 最强 zsh 插件管理器 zplugin 简介"/><meta name="keywords" content="linux, zsh, Aloxaf's blog" /><link rel="alternate" href="/atom.xml" title="Aloxaf's blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.svg?v=2.11.0" />
<link rel="canonical" href="https://www.aloxaf.com/2019/11/zplugin_tutorial/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123773630-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123773630-1');
</script><script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>加速你的 zsh —— 最强 zsh 插件管理器 zplugin 简介 - Aloxaf's blog</title>
  <link rel="alternate" href="/atom.xml" title="Aloxaf's blog" type="application/atom+xml">
</head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Aloxaf's blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">首页
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">归档
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于
          </li>
      </a><a href="/friends/">
        <li class="mobile-menu-item">友链
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Aloxaf's blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            首页
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            归档
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            标签
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            关于
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/friends/">
            友链
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">加速你的 zsh —— 最强 zsh 插件管理器 zplugin 简介
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-11-10
        </span><span class="post-category">
            <a href="/categories/linux/">linux</a>
            </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#自动安装"><span class="toc-text">自动安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手动安装"><span class="toc-text">手动安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置"><span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本插件加载"><span class="toc-text">基本插件加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Oh-My-Zsh-amp-Prezto"><span class="toc-text">使用 Oh My Zsh &amp; Prezto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码片段和性能"><span class="toc-text">代码片段和性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一些-Ice-修饰词"><span class="toc-text">一些 Ice 修饰词</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#as”program”"><span class="toc-text">as”program”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#atpull”…”"><span class="toc-text">atpull”…”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过-snippet-安装命令"><span class="toc-text">通过 snippet 安装命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过-snippet-安装补全"><span class="toc-text">通过 snippet 安装补全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#补全管理"><span class="toc-text">补全管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#列出补全"><span class="toc-text">列出补全</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启用和禁用补全"><span class="toc-text">启用和禁用补全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#子目录的-SVN-支持"><span class="toc-text">子目录的 SVN 支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Turbo-Mode-Zsh-gt-5-3"><span class="toc-text">Turbo Mode (Zsh &gt;= 5.3)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Turbo-Mode-加载复杂的命令提示符"><span class="toc-text">Turbo Mode 加载复杂的命令提示符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#按条件自动加载-卸载"><span class="toc-text">按条件自动加载/卸载</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Zplugin-Module"><span class="toc-text">Zplugin Module</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装方式"><span class="toc-text">安装方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#未安装-Zplugin"><span class="toc-text">未安装 Zplugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#已安装-Zplugin"><span class="toc-text">已安装 Zplugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用法"><span class="toc-text">用法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#关于-Oh-My-Zsh-碎碎念"><span class="toc-text">关于 Oh My Zsh 碎碎念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-粘贴代码太慢"><span class="toc-text">1. 粘贴代码太慢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-命令提示符响应太慢"><span class="toc-text">2. 命令提示符响应太慢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-启动速度太慢"><span class="toc-text">3. 启动速度太慢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zplugin-很强，但是我不想抛弃-OMZ-怎么办"><span class="toc-text">Zplugin 很强，但是我不想抛弃 OMZ 怎么办</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#一份示例配置"><span class="toc-text">一份示例配置</span></a></li></ol>
    </div>
  </div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="https://github.com/zdharma/zplugin" target="_blank" rel="noopener">Zplugin</a> 是个冷门但是却强大无比的 zsh 插件管理器，它拥有一个 killer feature —— Turbo mode，可以让插件在后台加载。这意味这你可以先加载最重要的插件，比如语法高亮和自动建议，剩下的可以统统放到后台加载，让你的 zsh 尽快进入可用状态。</p>
<p>利用这个机制，zplugin 可以将 zsh 的启动时间缩短到几十毫秒——以我的配置为例，只需要 35 毫秒左右。而使用传统的插件管理器比如 antigen，需要近 200 毫秒才能加载完成。</p>
<p>这里有一张图，对比了不同插件管理器的速度（来源：<a href="https://gist.github.com/laggardkernel/4a4c4986ccdcaf47b91e8227f9868ded" target="_blank" rel="noopener">Comparison of ZSH frameworks and plugin managers</a>）</p>
<p><img src="https://raw.githubusercontent.com/vintersnow/zsh_plugin_manager_speed/master/result.png" alt=""></p>
<p>可以看到 zplugin 在插件数目变多时速度……似乎更快了？？？<br>什么鬼，这个大概是实验误差吧，也有可能是第一次启动时编译了自身所以后面变快了。不过 zplugin 的速度是毋庸置疑的，哪怕这个插件需要数十秒来加载，只要放在后台加载，一样不影响你的 zsh 启动。</p>
<p>然而！！这个工具虽然强大，却没多少名气，让人倍感惋惜。</p>
<p>所以写下这篇文章，希望能有更多人了解到这个工具。<br>不过本文只涉及了它强大功能的冰山一角，深入研究推荐阅读 <a href="https://zdharma.org/zplugin/wiki/INTRODUCTION/" target="_blank" rel="noopener">Zplugin Wiki</a> 和 Zplugin 的 <a href="https://github.com/zdharma/zplugin/blob/master/README.md" target="_blank" rel="noopener">README</a></p>
<p>（如果你很懒不想研究的话，文末有一份完整的示例配置，安装完成后可以直接使用）</p>
<a id="more"></a>

<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="自动安装"><a href="#自动安装" class="headerlink" title="自动安装"></a>自动安装</h2><p>官方推荐的安装方式，一键完成。不过让我很没有安全感，我倾向于手动安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c "$(curl -fsSL https://raw.githubusercontent.com/zdharma/zplugin/master/doc/install.sh)"</span><br></pre></td></tr></table></figure>

<h2 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h2><p>首先 clone repo 到随便哪个位置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/zdharma/zplugin.git ~/.zplugin/bin</span><br></pre></td></tr></table></figure>

<p>然后在你的 ~/.zshrc 顶端添加如下语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zplugin/bin/zplugin.zsh</span><br></pre></td></tr></table></figure>

<p>安装完成，非常简单。</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><blockquote>
<p>我本打算从头写一篇教程，但是感觉自己要么讲得太多了，要么又讲得太少了。干脆直接翻译一下文档的 Introduction 部分吧（</p>
</blockquote>
<p>在本篇文档中，你将会学会如何：</p>
<ul>
<li>使用 Oh My Zsh 和 Prezto</li>
<li>管理补全</li>
<li>使用 Turbo mode</li>
<li>使用 ice 修饰词比如 <code>as&quot;program&quot;</code></li>
</ul>
<p>等等</p>
<h2 id="基本插件加载"><a href="#基本插件加载" class="headerlink" title="基本插件加载"></a>基本插件加载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin load zdharma/<span class="built_in">history</span>-search-multi-word</span><br><span class="line">zplugin light zsh-users/zsh-syntax-highlighting</span><br></pre></td></tr></table></figure>

<p>以上命令展示了两种最基本的加载插件的方式。</p>
<ul>
<li><code>load</code> 会启用报告功能——你可以通过 <code>zplugin report {plugin-spec}</code> 跟踪插件具体做了什么，也可以使用 <code>zplugin unload {plugin-spec}</code> 卸载插件。</li>
<li><code>light</code>无需跟踪和报告，可以提升加载速度，但是会导致失去查看插件报告和动态卸载插件的能力。</li>
</ul>
<blockquote>
<p>开启 Turbo mode 后跟踪插件所耗费的时间可以忽略不计</p>
</blockquote>
<h2 id="使用-Oh-My-Zsh-amp-Prezto"><a href="#使用-Oh-My-Zsh-amp-Prezto" class="headerlink" title="使用 Oh My Zsh &amp; Prezto"></a>使用 Oh My Zsh &amp; Prezto</h2><p>为了加载 Oh My Zsh 和 Prezto 插件，可以使用 <code>snippet</code> 功能加载代码片段。代码片段是指通过 <code>curl</code>、<code>wget</code> 等工具下载的单个文件。后面直接跟 URL 即可（会自动判断下载工具）。举例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin snippet <span class="string">'https://github.com/robbyrussell/oh-my-zsh/raw/master/plugins/git/git.plugin.zsh'</span></span><br><span class="line">zplugin snippet <span class="string">'https://github.com/sorin-ionescu/prezto/blob/master/modules/helper/init.zsh'</span></span><br></pre></td></tr></table></figure>

<p>此外，对于 Oh My Zsh 和 Prezto，你还可以使用缩写 <code>OMZ::</code> 和 <code>PZT::</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin snippet OMZ::plugins/git/git.plugin.zsh</span><br><span class="line">zplugin snippet PZT::modules/helper/init.zsh</span><br></pre></td></tr></table></figure>

<p>此外的此外，snippet 还支持 Subversion 协议，which GitHub 也支持。这可以让你加载包含多个文件的代码片段（比如 Prezto module 就有可能包含两个或者更多的文件，像 <code>init.zsh</code> 和 <code>alias.zsh</code>）。默认会被 source 的文件有：<code>*.plugin.zsh</code>, <code>init.zsh</code>, <code>*.zsh-theme</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL 指向目录</span></span><br><span class="line">zplugin ice svn</span><br><span class="line">zplugin snippet PZT::modules/docker</span><br></pre></td></tr></table></figure>

<h2 id="代码片段和性能"><a href="#代码片段和性能" class="headerlink" title="代码片段和性能"></a>代码片段和性能</h2><p>通过 <code>curl</code>，<code>wget</code> 等工具和 SVN ，你可以几乎完全避免加载 Oh My Zsh 和 Prezto 或者是其他框架的代码。这可以提高 <code>Zplugin</code> 的性能，而且更快更紧凑（指占用内存更小并且加载时间更短）。</p>
<h2 id="一些-Ice-修饰词"><a href="#一些-Ice-修饰词" class="headerlink" title="一些 Ice 修饰词"></a>一些 Ice 修饰词</h2><p>命令 <code>zplugin ice</code> 为下一条命令提供了 Ice 修饰词（详见 README <a href="https://github.com/zdharma/zplugin#ice-modifiers" target="_blank" rel="noopener">ice-modifiers</a> 一节）。啥意思呢：“ice” 是指一些被添加物（就像被添加到饮料或者咖啡里面的冰块）——在 Zplugin 中这意味着 ice 是被添加到下一条命令中的修饰词，冰块会融化（所以不会持续起作用）——在 Zplugin 中这意味着修饰词只对下一条命令起效。举例来说使用 <code>pick</code> ice 可以显示地选择被执行的文件：（译注：绕半天，其实就是可选参数）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice svn pick"init.zsh"</span><br><span class="line">zplugin snippet PZT::modules/git</span><br></pre></td></tr></table></figure>

<p>ice 修饰词的内容可以简单地放在 <code>&quot;...&quot;</code>, <code>&#39;...&#39;</code> 或 <code>$&#39;...&#39;</code> 中。不需要在 ice 修饰词名称的后面加上 <code>&quot;:&quot;</code> （尽管你这么做也没问题，而且加 <code>=</code> 也是可以的。比如 <code>pick=&quot;init.zsh&quot;</code> 或 <code>pick=init.zsh</code> 都是可行的）。<br>这样可以让 <code>vim</code>，<code>emacs</code> 之类的编辑器和 <code>zsh-users/zsh-syntax-highlighting</code> 或 <code>zdharma/fast-syntax-highlighting</code> 能够高亮 ice 修饰词的内容。</p>
<h2 id="as”program”"><a href="#as”program”" class="headerlink" title="as”program”"></a>as”program”</h2><p>插件并不一定是需要被 source 的脚本，也可以是需要添加到 <code>$PATH</code> 中的命令。为了实现这种效果，需要以 <code>program</code> 为参数调用 <code>as</code> ice （或者以 <code>command</code> 为参数也可以）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice as"program" cp"httpstat.sh -&gt; httpstat" pick"httpstat"</span><br><span class="line">zplugin light b4b4r07/httpstat</span><br></pre></td></tr></table></figure>

<p>上面的代码会将插件目录添加到 <code>$PATH</code> 中，并复制文件 <code>httpstat.sh</code> 为 <code>httpstat</code> ，并为 <code>pick</code> 选中的文件（本例中为 <code>httpstat</code>） 添加正确的可执行权限（<code>+x</code>）。还有一个修饰词 <code>mv</code>，它和 <code>cp</code> 的工作方式类似，只不过是移动文件而不是复制。<code>mv</code>的优先级比<code>cp</code>低。</p>
<blockquote>
<p><code>cp</code> 和 <code>mv</code> ice （还有其它的比如 <code>atclone</code>）只会在插件(或代码片段)被安装的时候运行。要想再次运行它们的话需要先使用 <code>zplugin delete PZT::modules/osx</code> 这类命令来删除插件）</p>
</blockquote>
<h2 id="atpull”…”"><a href="#atpull”…”" class="headerlink" title="atpull”…”"></a>atpull”…”</h2><p>复制文件相比移动来说是个更佳选择，它便于进行后续更新——因为 repo 中的原始文件并不会被修改，所以 <code>git</code> 不会报告冲突。不过，要想使用 <code>mv</code> 也是可以的，只要你正确使用了 <code>atpull</code> （一个在插件更新（update）的时候被调用的 ice）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice as<span class="string">"program"</span> mv<span class="string">"httpstat.sh -&gt; httpstat"</span> \</span><br><span class="line">      pick<span class="string">"httpstat"</span> atpull<span class="string">'!git reset --hard'</span></span><br><span class="line">zplugin light b4b4r07/httpstat</span><br></pre></td></tr></table></figure>

<p><code>atpull</code> 后面的命令以感叹号开头，意味着它会在 <code>git pull</code> 和 <code>mv</code> 之前被执行。此外 <code>atpull</code>, <code>mv</code>, <code>cp</code> 都只会在获取到新的提交的时候被执行。</p>
<p>总而言之，当用户执行 <code>zplugin update b4b4r07/httpstat</code> 来升级这个插件的时候，如果有新 commit，首先执行的是 <code>git reset --hard</code>——它会恢复原来的 <code>httpstat.sh</code>，然后 <code>git pull</code>被执行并拉取新的 commit（进行快进），然后 <code>mv</code> 再次被执行将命令名称修改为 <code>httpstat</code> 而不是 <code>httpstat.sh</code>。这样 <code>mv</code> 可以用于永久性更新插件的内容而且不会阻碍插件使用 <code>git</code> （或 <code>subversion</code> ）更新。</p>
<blockquote>
<p>在 zsh 的交互式会话中，为了避免感叹号被展开，请使用 <code>&#39;...&#39;</code> 而不是 <code>&quot;...&quot;</code> 来包裹 <code>atpull</code> ice 的内容</p>
</blockquote>
<h2 id="通过-snippet-安装命令"><a href="#通过-snippet-安装命令" class="headerlink" title="通过 snippet 安装命令"></a>通过 snippet 安装命令</h2><p>也可以使用 snippet 添加命令。比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice mv"httpstat.sh -&gt; httpstat" \</span><br><span class="line">        pick"httpstat" as"program"</span><br><span class="line">zplugin snippet \</span><br><span class="line">    https://github.com/b4b4r07/httpstat/blob/master/httpstat.sh</span><br></pre></td></tr></table></figure>

<p>注：Snippet 也支持 <code>atpull</code>，所以可以这样写 <code>atpull&#39;!svn revert&#39;</code> 。还有 <code>atinit</code>，可以在每次加载插件或 snippet 的时候被执行。</p>
<h2 id="通过-snippet-安装补全"><a href="#通过-snippet-安装补全" class="headerlink" title="通过 snippet 安装补全"></a>通过 snippet 安装补全</h2><p>以 <code>completion</code> 为参数调用 <code>as</code> ice，可以让 <code>snippet</code> 命令直接加载一个补全文件，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice as<span class="string">"completion"</span></span><br><span class="line">zplugin snippet https://github.com/docker/cli/blob/master/contrib/completion/zsh/_docker</span><br></pre></td></tr></table></figure>

<h2 id="补全管理"><a href="#补全管理" class="headerlink" title="补全管理"></a>补全管理</h2><p>Zplugin 允许禁用/启动任意插件的任意一条补全。试着安装一个提供了补全的流行插件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice blockf</span><br><span class="line">zplugin light zsh-users/zsh-completions</span><br></pre></td></tr></table></figure>

<p>第一条命令（<code>blockf</code> ice）将会阻断传统的添加补全的方式。zplugin 会使用它自己的方式（基于符号链接而不是往 <code>$fpath</code> 里加一堆目录）。Zplugin 将会自动安装它下载的插件的补全。想要卸载这些补全并且重新安装的话，可以使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin cuninstall zsh-users/zsh-completions   <span class="comment"># 卸载</span></span><br><span class="line">zplugin creinstall zsh-users/zsh-completions   <span class="comment"># 安装</span></span><br></pre></td></tr></table></figure>

<h3 id="列出补全"><a href="#列出补全" class="headerlink" title="列出补全"></a>列出补全</h3><blockquote>
<p>注： <code>zplg</code> 是一个可以在交互式会话中使用的别名</p>
</blockquote>
<p>要以表格形式查看每个插件都提供哪些补全和插件的名字，请使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zplg clist</span><br></pre></td></tr></table></figure>

<p>这个命令特别适用于 <code>zsh-users/zsh-completions</code> 这类提供了大量补全的插件——表格每行将会展示三个补全（这样可以占用的终端页面的大小）就像这样</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">atach, bitcoin-cli, bower    zsh-users/zsh-completions</span><br><span class="line">bundle, caffeinate, <span class="built_in">cap</span>      zsh-users/zsh-completions</span><br><span class="line">cask, cf, chattr             zsh-users/zsh-completions</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>你也可以通过给 <code>clist</code> 添加参数来提高每行显示的补全的数目，比如 <code>zplg clist 6</code> 将会显示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">bundle, caffeinate, <span class="built_in">cap</span>, cask, cf, chattr      zsh-users/zsh-completions</span><br><span class="line">cheat, choc, cmake, coffee, column, composer   zsh-users/zsh-completions</span><br><span class="line">console, dad, debuild, dget, dhcpcd, diana     zsh-users/zsh-completions</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="启用和禁用补全"><a href="#启用和禁用补全" class="headerlink" title="启用和禁用补全"></a>启用和禁用补全</h2><p>补全可以被禁用，这样就可以调用 zsh 的原始补全。这个命令非常简单，它只需要补全的名称作为参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> zplg cdisable cmake</span></span><br><span class="line">Disabled cmake completion belonging to zsh-users/zsh-completions</span><br><span class="line"><span class="meta">$</span><span class="bash"> zplg cenable cmake</span></span><br><span class="line">Enabled cmake completion belonging to zsh-users/zsh-completions</span><br></pre></td></tr></table></figure>

<p>就这么简单。还有一个命令 <code>zplugin csearch</code>，可以搜索所有的插件目录列出所有可用的补全并且展示它们是否被启用。</p>
<p><img src="https://zdharma.org/zplugin/wiki/img/csearch.png" alt="#csearch screenshot"></p>
<p>这就实现了对补全的完全控制。</p>
<h2 id="子目录的-SVN-支持"><a href="#子目录的-SVN-支持" class="headerlink" title="子目录的 SVN 支持"></a>子目录的 SVN 支持</h2><p>通常，为了使用 GitHub 项目的子目录作为 snippet，需要在 URL中添加 <code>/trunk/{path-to-dir}</code>，比如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice svn</span><br><span class="line">zplugin snippet https://github.com/zsh-users/zsh-completions/trunk/src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于 Oh My Zsh 和 Prezto, 可以直接使用 OMZ:: 和 PZT:: 前缀</span></span><br><span class="line"><span class="comment"># 不需要添加 `/trunk/`， （不过路径需要指向一个目录而不是文件）</span></span><br><span class="line">zplugin ice svn; zplugin snippet PZT::modules/docker</span><br></pre></td></tr></table></figure>

<p>snippet 也会默认自动安全可用补全，就像 plugin 一样。</p>
<h2 id="Turbo-Mode-Zsh-gt-5-3"><a href="#Turbo-Mode-Zsh-gt-5-3" class="headerlink" title="Turbo Mode (Zsh &gt;= 5.3)"></a>Turbo Mode (Zsh &gt;= 5.3)</h2><p><code>wait</code> ice 允许你将插件的加载过程延迟到 <code>.zshrc</code> 加载完成并且 prompt 已经显示出来以后。就像 Windows 一样——在启动过程中，即使后台依然在加载数据，它也会显示桌面。尽管这有缺点，不过总比黑屏十分钟要好。<br>然而，在 Zplugin 中，这个方法没有缺点——窗口不会延迟、冻结等等——在插件被加载的过程中，你的命令行完全处于可用状态，即使插件数量有十多二十个。</p>
<blockquote>
<p>Turbo mode 将会加速 zsh 的启动过程 50%～73% 之多。比如原先是 200ms，现在就只需要 50ms！</p>
</blockquote>
<p>这个功能需要 Zsh 5.3 及以上版本。为了使用 Turbo mode，可以参照以下方式为你的插件添加 <code>wait</code> ice：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS1=<span class="string">"READY &gt; "</span></span><br><span class="line">zplugin ice <span class="built_in">wait</span><span class="string">'!0'</span> </span><br><span class="line">zplugin load halfo/lambda-mod-zsh-theme</span><br></pre></td></tr></table></figure>

<p>上面的代码让 <code>psprint/zprompts</code> 插件在 <code>zshrc</code> 处理完毕后的 <code>0</code> 秒后启动。它会在基本的命令提示符 <code>READY &gt;</code> 出现后的大概 1ms 后启动。我已经使用这种方式来设置我的命令提示符两年多了，没有丝毫问题。 只提供 <code>wait</code> 一个词也是可以的，它的效果等同于 <code>wait&#39;0&#39;</code>（同样 <code>wait&#39;!&#39;</code>等同于 <code>wait&#39;!0&#39;</code>）</p>
<p>感叹号让 Zplugin 在插件加载完毕后重设命令提示符，对于延迟加载主题来说是很有必要的。Prezto 主题也是一样，下面的例子使用了更长的延迟</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplg ice svn silent wait'!1' atload'prompt smiley'</span><br><span class="line">zplg snippet PZT::modules/prompt</span><br></pre></td></tr></table></figure>



<p>延迟加载 <code>zsh-users/zsh-autosuggestions</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice wait lucid atload'_zsh_autosuggest_start'</span><br><span class="line">zplugin light zsh-users/zsh-autosuggestions</span><br></pre></td></tr></table></figure>

<p>解释：Autosuggesstions 使用了 <code>precmd</code> 钩子，它会在处理完 <code>zshrc</code> 之后（刚好在第一个命令提示符出现之前）被调用。然而 Turbo mode 会在 <code>zshrc</code> 加载完成 1s 后再加载它，使得在第一个命令提示符下 <code>precmd</code> 将不会被安装并调用。这就会让 autosuggesstions 在第一个命令提示符下处于不可用状态。但 <code>atload</code> ice 可以修复这个问题，它可以在插件加载完成后调用同样的函数，就像 <code>precmd</code> 做的那样，这样就可以获得一致的体验。</p>
<p><code>lucid</code> ice 可以隐藏 Turbo mode 下插件加载完成的提示，类似 <code>Loaded zsh-users/zsh-autosuggestions</code></p>
<h3 id="Turbo-Mode-加载复杂的命令提示符"><a href="#Turbo-Mode-加载复杂的命令提示符" class="headerlink" title="Turbo Mode 加载复杂的命令提示符"></a>Turbo Mode 加载复杂的命令提示符</h3><p>某些高级主题的初始化过程是通过 <code>precmd</code> 钩子完成的（一些需要在每个命令提示符出现之前被调用的函数）。这个钩子被通过 zsh 函数 <a href="https://zdharma.org/zplugin/wiki/zsh-plugin-standard/#use_of_add-zsh-hook_to_install_hooks" target="_blank" rel="noopener">add-zsh-hook</a> 以将函数名添加到 <code>$precmd_functions</code> 数组中的方式被安装。</p>
<p>为了使命令提示符在用 Turbo mode 半路加载完主题后被完全初始化，需要使用 <code>atload&#39;&#39;</code> ice 调用这个 hook。</p>
<p>首先，检查 <code>$precmd_function</code> 数字来获取钩子函数的名称。举例来说，在 <code>robobenklein/zinc</code> 主题中，将会有两个函数：<code>prompt_zinc_setup</code> 和 <code>prompt_zinc_precmd</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@sg &gt; ~ &gt; print $precmd_functions                       &lt; ✔ &lt; 22:21:33</span><br><span class="line">_zsh_autosuggest_start prompt_zinc_setup prompt_zinc_precmd</span><br></pre></td></tr></table></figure>

<p>然后，把他们添加到 <code>atload&#39;&#39;</code> ice 中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zplugin ice wait'!' lucid nocd \</span><br><span class="line">    atload'!prompt_zinc_setup; prompt_zinc_precmd'</span><br><span class="line">zplugin load robobenklein/zinc</span><br></pre></td></tr></table></figure>

<p><code>atload&#39;!...&#39;</code> 中的感叹号会让 Zplugin 跟踪这个函数以便卸载插件，详见 <a href="https://zdharma.org/zplugin/wiki/atload-and-other-at-ices/" target="_blank" rel="noopener">这儿</a>。这个对于接下来会提到的设置多个命令提示符会有用。</p>
<h2 id="按条件自动加载-卸载"><a href="#按条件自动加载-卸载" class="headerlink" title="按条件自动加载/卸载"></a>按条件自动加载/卸载</h2><p><code>load</code> 和 <code>unload</code> ice 允许你定义插件什么时候需要被激活或者禁用。举例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 处于 ~/tmp 时加载</span></span><br><span class="line"></span><br><span class="line">zplugin ice load<span class="string">'![[ $PWD = */tmp* ]]'</span> unload<span class="string">'![[ $PWD != */tmp* ]]'</span> \</span><br><span class="line">    atload<span class="string">"!promptinit; prompt sprint3"</span></span><br><span class="line">zplugin load psprint/zprompts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不在 ~/tmp 时加载</span></span><br><span class="line"></span><br><span class="line">zplugin ice load<span class="string">'![[ $PWD != */tmp* ]]'</span> unload<span class="string">'![[ $PWD = */tmp* ]]'</span></span><br><span class="line">zplugin load russjohnson/angry-fly-zsh</span><br></pre></td></tr></table></figure>

<p>两个命令提示符，每个都在不同的目录下生效，这个技术可以用来定义不同的插件组，比如定义一个 <code>$PLUGINS</code> 和可能的值比如 <code>cpp</code>, <code>web</code>, <code>admin</code>，并且设置 <code>load</code>/<code>unload</code> 条件来激活 <code>cpp</code>， <code>web</code> 中不同的插件。</p>
<blockquote>
<p><code>load</code>/<code>unload</code>和 <code>wait</code> 的不同之处是它始处于激活状态，而不是只在只在第一次加载时有效。</p>
</blockquote>
<p>需要注意的是，要使卸载插件功能正常工作，你需要跟踪插件的加载过程（所以需要使用 <code>zplugin load ...</code> 而不是 <code>zplugin light ...</code>）。跟踪过程有轻微的性能损耗，不能在开启了 Turbo mode 后并不后影响 zsh 的启动时间。</p>
<p>可以参见 WIki 的 <a href="https://zdharma.org/zplugin/wiki/Multiple-prompts/" target="_blank" rel="noopener">multi prompts</a> 一节，它包含了一个使用多个命令提示符的跟现实的例子，和作者自己目前所使用的类似。</p>
<h1 id="Zplugin-Module"><a href="#Zplugin-Module" class="headerlink" title="Zplugin Module"></a>Zplugin Module</h1><p>这也是一个强力功能，不过在 Turbo Mode 的光环下就黯然失色了。</p>
<p>它的功能是自动编译被 source 的脚本，虽然我并没有观察到这个功能起效。。。</p>
<p>但是它还有一个功能——查看每个被 source 过的脚本的执行时间，这个功能十分强大，可以迅速找出拖慢你 zsh 启动的元凶。</p>
<h2 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h2><h3 id="未安装-Zplugin"><a href="#未安装-Zplugin" class="headerlink" title="未安装 Zplugin"></a>未安装 Zplugin</h3><p>没有安装 Zplugin 时也是可以使用这个模块的，对于某些不带编译功能的插件管理器来说有一定帮助。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/zdharma/zplugin/master/doc/mod-install.sh)</span>"</span></span><br></pre></td></tr></table></figure>

<p>脚本执行完会提示你添加两行代码到 <code>~/.zshrc</code> 顶部</p>
<h3 id="已安装-Zplugin"><a href="#已安装-Zplugin" class="headerlink" title="已安装 Zplugin"></a>已安装 Zplugin</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zplugin module build</span><br></pre></td></tr></table></figure>

<p>同样，脚本执行完会提示你添加两行代码到 <code>~/.zshrc</code> 顶部</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>使用 <code>zpmod source-study</code> 就可以查看每个脚本的执行时间了，加上 <code>-l</code> 参数还可以显示脚本的完整路径。十分好用！</p>
<h1 id="关于-Oh-My-Zsh-碎碎念"><a href="#关于-Oh-My-Zsh-碎碎念" class="headerlink" title="关于 Oh My Zsh 碎碎念"></a>关于 Oh My Zsh 碎碎念</h1><p>有不少 zsh 用户都嫌弃 Oh My Zsh（以下简称 OMZ），主要嫌弃它的速度太慢。（还有很蛋疼的一点就是想找点 zsh 语法的教程看看，结果搜索结果清一色的 OMZ 配置教程，只有<a href="https://github.com/goreliu/zshguide" target="_blank" rel="noopener">一篇文章</a>是在讲 zsh 本身的。行吧，我去 RTFM 了。）</p>
<p>这个慢主要体现在三点：</p>
<h2 id="1-粘贴代码太慢"><a href="#1-粘贴代码太慢" class="headerlink" title="1. 粘贴代码太慢"></a>1. 粘贴代码太慢</h2><p>这个确实没得洗，OMZ 默认启用了一个非常烦人的自动 URL 转义的功能。这个功能会<strong>极大</strong>拖慢粘贴的速度，而且这个功能在长达数年的时间里都是<strong>无法被除了修改源码以外的方式</strong>关闭的(<a href="https://github.com/robbyrussell/oh-my-zsh/issues/5569" target="_blank" rel="noopener">oh-my-zsh#5569</a>)，直到今年五月份才终于加入了一个用于控制这个功能开关的变量，然而似乎还是默认开启的。这个功能不知道劝退了多少 OMZ 的用户……</p>
<p>总之，如果你是 OMZ 的忠实粉丝，看完本文后依然坚持使用 OMZ，建议立即更新并使用 <code>DISABLE_MAGIC_FUNCTIONS=true</code> 关闭这个功能。</p>
<h2 id="2-命令提示符响应太慢"><a href="#2-命令提示符响应太慢" class="headerlink" title="2. 命令提示符响应太慢"></a>2. 命令提示符响应太慢</h2><p>这个其实是可以洗的——你别选那么花哨的主题就行了啊。</p>
<p>拖慢命令提示符响应速度的大头是 git 信息的统计。这个功能其实挺不错的，然而会导致在首次进入大 repo 时卡顿，尤其是在 HDD 上，甚至能卡数秒，难以忍受。</p>
<p>那么 OMZ 有没有不显示git 信息的主题呢？</p>
<p>答案是没有……</p>
<p>那么简单的主题你好意思提交到 OMZ 上去吗！这样的主题只能自己写了，比如我用了挺久的 <a href="https://github.com/Aloxaf/dotfiles/blob/master/zsh/.config/zsh/custom/themes/loli.zsh-theme" target="_blank" rel="noopener">loli 主题</a> （然而没有任何 loli 要素）。</p>
<p>不过看完这篇文章你肯定会想，既然插件可以异步加载，git 信息可不可以异步加载呢？</p>
<p>答案是可以！一个著名主题 <a href="https://github.com/sindresorhus/pure" target="_blank" rel="noopener">Pure</a> 就是这么做的，兼顾了美观与实用性，即使再大的 repo 也能够秒进。</p>
<h2 id="3-启动速度太慢"><a href="#3-启动速度太慢" class="headerlink" title="3. 启动速度太慢"></a>3. 启动速度太慢</h2><p>这个和 OMZ 没啥关系，主要是你插件太多了。除了 Zplugin 外，其他插件管理器/框架都存在这个问题。</p>
<p>解决方案就是换 Zplugin（其实还有一个实现了多线程加载的 Zplug，就是文章开头那张图中最慢的那一个……想法很好，但实现很挫）</p>
<h2 id="Zplugin-很强，但是我不想抛弃-OMZ-怎么办"><a href="#Zplugin-很强，但是我不想抛弃-OMZ-怎么办" class="headerlink" title="Zplugin 很强，但是我不想抛弃 OMZ 怎么办"></a>Zplugin 很强，但是我不想抛弃 OMZ 怎么办</h2><p>前面已经说了，Zplugin 可以直接加载 OMZ 的插件，所以 OMZ 的好处你都能享受到。</p>
<p>当然，你会发现即使加载了 OMZ 插件，使用体验还是和 OMZ 不一致。<br>因为 zsh 的很多功能是默认没有开启的，你可以手动开启，或者如果你和我一样懒的话，还可以直接用 snippet 选择性加载 OMZ 的部分功能。举例如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zplg snippet OMZ::lib/completion.zsh</span><br><span class="line">zplg snippet OMZ::lib/history.zsh</span><br><span class="line">zplg snippet OMZ::lib/key-bindings.zsh</span><br><span class="line">zplg snippet OMZ::lib/theme-and-appearance.zsh</span><br></pre></td></tr></table></figure>

<p>上面的代码加载了 OMZ 对补全、历史、键位绑定、主题等的设置，对于我来说基本上和 OMZ 的使用体验就一致了。如果还想要什么功能的话，可以直接去 OMZ 的 lib 目录下找。</p>
<h1 id="一份示例配置"><a href="#一份示例配置" class="headerlink" title="一份示例配置"></a>一份示例配置</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zplugin/bin/zplugin.zsh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 快速目录跳转</span></span><br><span class="line">zplg ice lucid wait='1'</span><br><span class="line">zplg light skywind3000/z.lua</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 语法高亮</span></span><br><span class="line">zplg ice lucid wait='0' atinit='zpcompinit'</span><br><span class="line">zplg light zdharma/fast-syntax-highlighting</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自动建议</span></span><br><span class="line">zplg ice lucid wait="0" atload='_zsh_autosuggest_start'</span><br><span class="line">zplg light zsh-users/zsh-autosuggestions</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 补全</span></span><br><span class="line">zplg ice lucid wait='0'</span><br><span class="line">zplg light zsh-users/zsh-completions</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加载 OMZ 框架及部分插件</span></span><br><span class="line">zplg snippet OMZ::lib/completion.zsh</span><br><span class="line">zplg snippet OMZ::lib/history.zsh</span><br><span class="line">zplg snippet OMZ::lib/key-bindings.zsh</span><br><span class="line">zplg snippet OMZ::lib/theme-and-appearance.zsh</span><br><span class="line">zplg snippet OMZ::plugins/colored-man-pages/colored-man-pages.plugin.zsh</span><br><span class="line">zplg snippet OMZ::plugins/sudo/sudo.plugin.zsh</span><br><span class="line"></span><br><span class="line">zplg ice svn</span><br><span class="line">zplg snippet OMZ::plugins/extract</span><br><span class="line"></span><br><span class="line">zplg ice lucid wait='1'</span><br><span class="line">zplg snippet OMZ::plugins/git/git.plugin.zsh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加载 pure 主题</span></span><br><span class="line">zplg ice pick"async.zsh" src"pure.zsh"</span><br><span class="line">zplg light sindresorhus/pure</span><br></pre></td></tr></table></figure>

<p>安装完 Zplugin 后，可以将以上代码粘贴到 <code>~/.zshrc</code> 中，然后建议<strong>挂着代理</strong>启用 zsh（因为会从 GitHub clone，所以第一次启动会比较慢，根据你的网络状况可能需要几十秒到几十分钟不等</p>
<p>本来还有一段安装一些常用工具的代码，不过一方面这些工具最好的安装方式应该是通过系统包管理工具安装，另一方面加上这段可能会让网络不好的朋友非常痛苦，故单独提出来放在下面。</p>
<p>需要的话可以把这段放到 source 后面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---- (可选)加载了一堆二进制程序 ----</span></span><br><span class="line">zplg light zplugin/z<span class="_">-a</span>-bin-gem-node</span><br><span class="line"></span><br><span class="line">zplg as=<span class="string">"null"</span> <span class="built_in">wait</span>=<span class="string">"1"</span> lucid from=<span class="string">"gh-r"</span> <span class="keyword">for</span> \</span><br><span class="line">    mv=<span class="string">"exa* -&gt; exa"</span> sbin       ogham/exa \</span><br><span class="line">    mv=<span class="string">"*/rg -&gt; rg"</span>  sbin		BurntSushi/ripgrep \</span><br><span class="line">    mv=<span class="string">"fd* -&gt; fd"</span>   sbin=<span class="string">"fd/fd"</span>  @sharkdp/fd \</span><br><span class="line">    sbin=<span class="string">"fzf"</span>       junegunn/fzf-bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载它们的补全等</span></span><br><span class="line">zplg ice mv=<span class="string">"*.zsh -&gt; _fzf"</span> as=<span class="string">"completion"</span></span><br><span class="line">zplg snippet <span class="string">'https://github.com/junegunn/fzf/blob/master/shell/completion.zsh'</span></span><br><span class="line">zplg snippet <span class="string">'https://github.com/junegunn/fzf/blob/master/shell/key-bindings.zsh'</span></span><br><span class="line">zplg ice as=<span class="string">"completion"</span></span><br><span class="line">zplg snippet <span class="string">'https://github.com/robbyrussell/oh-my-zsh/blob/master/plugins/fd/_fd'</span></span><br><span class="line">zplg ice mv=<span class="string">"*.zsh -&gt; _exa"</span> as=<span class="string">"completion"</span></span><br><span class="line">zplg snippet <span class="string">'https://github.com/ogham/exa/blob/master/contrib/completions.zsh'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不需要花里胡哨的 ls，我们有更花里胡哨的 exa</span></span><br><span class="line">DISABLE_LS_COLORS=<span class="literal">true</span></span><br><span class="line"><span class="built_in">alias</span> ls=exa</span><br><span class="line"><span class="comment"># 配置 fzf 使用 fd</span></span><br><span class="line"><span class="built_in">export</span> FZF_DEFAULT_COMMAND=<span class="string">'fd --type f'</span></span><br><span class="line"><span class="comment"># ---- 加载完了 ----</span></span><br></pre></td></tr></table></figure>


      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="https://www.aloxaf.com">Aloxaf</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="https://www.aloxaf.com/2019/11/zplugin_tutorial/">https://www.aloxaf.com/2019/11/zplugin_tutorial/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/linux/">linux</a>
            <a href="/tags/zsh/">zsh</a>
            </div>
        
        <nav class="post-nav"><a class="next" href="/2019/11/xkeysnail_tutorial/">
        <span class="next-text nav-default">xkeysnail 使用指南</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:aloxafx@gmail.com" target="_blank" rel="noopener" class="iconfont icon-email" title="email"></a>
        <a href="https://github.com/Aloxaf" target="_blank" rel="noopener" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>
  </span>

  <span class="copyright-year">&copy;2017 - 2019<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Aloxaf</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
