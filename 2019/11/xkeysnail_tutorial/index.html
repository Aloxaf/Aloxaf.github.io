<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="xkeysnail 使用指南"/><meta name="keywords" content="linux, emacs, 教程, Aloxaf's blog" /><link rel="alternate" href="/atom.xml" title="Aloxaf's blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.svg?v=2.11.0" />
<link rel="canonical" href="https://www.aloxaf.com/2019/11/xkeysnail_tutorial/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123773630-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123773630-1');
</script><script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>xkeysnail 使用指南 - Aloxaf's blog</title>
  <link rel="alternate" href="/atom.xml" title="Aloxaf's blog" type="application/atom+xml">
</head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Aloxaf's blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">首页
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">归档
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于
          </li>
      </a><a href="/friends/">
        <li class="mobile-menu-item">友链
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Aloxaf's blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            首页
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            归档
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            标签
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            关于
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/friends/">
            友链
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">xkeysnail 使用指南
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-11-03
        </span><span class="post-category">
            <a href="/categories/%E6%95%99%E7%A8%8B/">教程</a>
            </span>
        <span id="2019/11/xkeysnail_tutorial/" class="leancloud_visitors" data-flag-title="xkeysnail 使用指南">
            <i class="leancloud-visitors-count" style="display: none;">0</i>
          </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#emacs-keybings-everywhere"><span class="toc-text">Emacs keybings Everywhere!</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#arch-linux"><span class="toc-text">Arch Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#other"><span class="toc-text">Other</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用法"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编写-config-py"><span class="toc-text">编写 config.py</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动启动"><span class="toc-text">自动启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#赋予当前用户必要权限"><span class="toc-text">赋予当前用户必要权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写-service"><span class="toc-text">编写 service</span></a></li></ol></li></ol></li></ol>
    </div>
  </div><div class="post-content"><h1 id="emacs-keybings-everywhere"><a class="headerlink" href="#emacs-keybings-everywhere"></a>Emacs keybings Everywhere!</h1>
<h2 id="简介"><a class="headerlink" href="#简介"></a>简介</h2>
<p>xkeysnail 是一个非常强大的 keyboard remapping 工具, 它类似于 xmodmap, 但更为灵活. 不仅能重映射键位, 还能重映射快捷键, 甚至能在不同的程序下使用不同的映射!</p>
<p>再也不用两套快捷键换来换去了!! ( 早点知道这个东西, 我就不至于练就一身无缝切换快捷键的毫无卵用的本领了...</p>
<p>项目地址: <a href="https://github.com/mooz/xkeysnail" target="_blank" rel="noopener">https://github.com/mooz/xkeysnail</a></p>
<a id="more"></a>
<h2 id="安装"><a class="headerlink" href="#安装"></a>安装</h2>
<h3 id="arch-linux"><a class="headerlink" href="#arch-linux"></a>Arch Linux</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pikaur -S xkeysnail</span><br></pre></td></tr></table></figure>
<h3 id="other"><a class="headerlink" href="#other"></a>Other</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install xkeysnail --user</span><br></pre></td></tr></table></figure>
<p>注: 官方文档里使用的是 <code>sudo pip</code> 来安装, 但不推荐这样做. 尤其是 pip 这种辣鸡包管理器, 很容易把系统的包管理搞乱.</p>
<h2 id="用法"><a class="headerlink" href="#用法"></a>用法</h2>
<p>首先下载 <a href="https://github.com/mooz/xkeysnail/blob/master/example/config.py" target="_blank" rel="noopener">官方示例</a>, 然后用以下命令执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo xkeysnail config.py</span><br></pre></td></tr></table></figure>
<p>不出意外地话应该没有报错, 然可以切换到一个不支持 Emacs 快捷键的环境, 比如浏览器. 试一下 C-a, C-e 等基本的快捷键是否能工作.</p>
<p>如果遇到 <code>Xlib.error.DisplayConnectionError: Can't connect to display &quot;:0.0&quot;: b'No protocol specified\n'</code> 这样的错误, 可以尝试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xhost +SI:localuser:root</span><br><span class="line">sudo xkeysnail config.py</span><br></pre></td></tr></table></figure>
<p>其中 xhost 命令需要通过 <code>pacman -S xorg-xhost</code> 安装</p>
<p>如果你有热插拔键盘的需求, 还需要加上 <code>-watch</code> 开关</p>
<h2 id="编写-config-py"><a class="headerlink" href="#编写-config-py"></a>编写 <a href="http://config.py" target="_blank" rel="noopener">config.py</a></h2>
<p>如果你是 Emacs user 的话, 基本上直接使用官方配置就行了...最多加一下白名单, 比如我的 Alacritty 和 JB 家的 IDE 都是 Emacs 风格快捷键, 就可以排除它们了.</p>
<blockquote>
<p>运行 <code>xprop WM_CLASS</code>, 然后点击目标窗口, 就可以获得这个窗口的 wm_class</p>
</blockquote>
<p>如果打算自己编写的话也非常容易, 官方示例有详细的注释, 可以照着示例来写.</p>
<p>我遇到的唯一一个坑是我的 Compose 键占用了右 Ctrl, 然后导致有些快捷键不起作用 ( 我也不知道为什么这些快捷键会使用右 Ctrl...)<br>
所以如果你配置了其他键盘映射程序建议暂时关掉, 免得出现莫名其妙的错误.</p>
<h2 id="自动启动"><a class="headerlink" href="#自动启动"></a>自动启动</h2>
<p>启动 xkeysnail 后, 我们基本上可以在每个应用里都愉快地使用 Emacs 风格的快捷键了.<br>
但是还缺一个自动启动, 推荐编写一个 systemd 服务来完成. ( systemd 是个好东西, 应该多多使用 )</p>
<h3 id="赋予当前用户必要权限"><a class="headerlink" href="#赋予当前用户必要权限"></a>赋予当前用户必要权限</h3>
<p>这个步骤的目的是让 xkeysnail 不需要 root 权限也能执行.</p>
<p>首先我们增加一个 uinput 组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd uinput</span><br></pre></td></tr></table></figure>
<p>然后将当前用户添加到 input 和 uinput 组中<br>
( 这个步骤似乎并不是即时生效的, 执行完这条命令可以用 <code>groups</code> 查看一下当前用户所属的组, 如果没有 input &amp; uinput 的话可以重启或者重新登录试试 )</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -a -G input,uinput $USER</span><br></pre></td></tr></table></figure>
<p>然后编写两个 udev 规则, 放在 <code>/etc/udev/rules.d/</code> 下</p>
<p>input.rules</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KERNEL=="event*", NAME="input/%k", MODE="660", GROUP="input"</span><br></pre></td></tr></table></figure>
<p>uinput.rules</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KERNEL=="uinput", GROUP="uinput"</span><br></pre></td></tr></table></figure>
<p>接着应用这两条规则</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo udevadm control --reload-rules &amp;&amp; udevadm trigger</span><br></pre></td></tr></table></figure>
<h3 id="编写-service"><a class="headerlink" href="#编写-service"></a>编写 service</h3>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://qiita.com/samurai20000@github/items/2e1d779e806a7e8543d6</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=xkeysnail</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="comment"># DISPLAY 的值应该和 `echo $DISPLAY` 的值相同</span></span><br><span class="line"><span class="attr">Environment</span>=DISPLAY=:<span class="number">0</span></span><br><span class="line"><span class="attr">ExecStartPre</span>=-xhost +SI:localuser:root</span><br><span class="line"><span class="comment"># 此处禁用了按键状态的输出, 因为我不想要一大堆毫无卵用的日志...</span></span><br><span class="line"><span class="attr">ExecStart</span>=xkeysnail -q /home/aloxaf/.config/xkeysnail/config.py</span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=default.target</span><br></pre></td></tr></table></figure>
<p>将以上代码保存为 <code>~/.config/systemd/user/xkeysnail.service</code>,<br>
然后执行 <code>systemctl --user --now enable xkeysnail.service</code>.</p>
<p>完成了! 享受到处都能使用 Emacs 风格快捷键的快感吧!</p>
<p>顺便列举下 systemd 的常用操作 ( 推荐 <code>alias userctl='systemctl --user'</code>)</p>
<ul>
<li><code>userctl status xkeysnail.service</code> 查看服务状态</li>
<li><code>userctl restart xkeysnail.service</code> 重启服务</li>
<li><code>journalctl --user -u xkeysnail.service</code> 查看完整日志</li>
<li><code>journalctl --user -f -u xkeysnail.service</code> 查看最近日志</li>
</ul>
<p>参考资料: <a href="https://qiita.com/samurai20000@github/items/2e1d779e806a7e8543d6%60" target="_blank" rel="noopener">https://qiita.com/samurai20000@github/items/2e1d779e806a7e8543d6`</a></p>

      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="https://www.aloxaf.com">Aloxaf</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="https://www.aloxaf.com/2019/11/xkeysnail_tutorial/">https://www.aloxaf.com/2019/11/xkeysnail_tutorial/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/linux/">linux</a>
            <a href="/tags/emacs/">emacs</a>
            <a href="/tags/%E6%95%99%E7%A8%8B/">教程</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/2019/11/zplugin_tutorial/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">加速你的 zsh —— 最强 zsh 插件管理器 zplugin 教程</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    <a class="next" href="/2019/09/cdda_note/">
        <span class="next-text nav-default">CDDA 幸存者笔记</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"><div id="vcomments"></div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:aloxafx@gmail.com" target="_blank" rel="noopener" class="iconfont icon-email" title="email"></a>
        <a href="https://github.com/Aloxaf" target="_blank" rel="noopener" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>
  </span>

  <span class="copyright-year">&copy;2017 - 2019<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Aloxaf</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
<!-- valine Comments -->
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        serverURLs: "https://lcd.aloxaf.cn",
        notify: false,
        verify: false,
        app_id: "fSbXaElXXTznggVXiWy8NFBU-gzGzoHsz",
        app_key: "kK3SxB14xAACgHftKrSaBRDU",
        placeholder: "妙啊，妙啊",
        avatar: 'mm',
        visitor: true,
    });
</script>
<script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
